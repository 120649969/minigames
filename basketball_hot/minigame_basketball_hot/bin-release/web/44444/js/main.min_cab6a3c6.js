var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))(function(n,l){function _(t){try{s(a.next(t))}catch(e){l(e)}}function o(t){try{s(a["throw"](t))}catch(e){l(e)}}function s(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(_,o)}s((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,l&&(_=l[2&i[0]?"return":i[0]?"throw":"next"])&&!(_=_.call(l,i[1])).done)return _;switch(l=0,_&&(i=[0,_.value]),i[0]){case 0:case 1:_=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,l=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(_=s.trys,!(_=_.length>0&&_[_.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!_||i[1]>_[0]&&i[1]<_[3])){s.label=i[1];break}if(6===i[0]&&s.label<_[1]){s.label=_[1],_=i;break}if(_&&s.label<_[2]){s.label=_[2],s.ops.push(i);break}_[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(a){i=[6,a],l=0}finally{n=_=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,l,_,o,s={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function a(a){e.call(i,a,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?a(n):RES.getResAsync(t,a,this)}else RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DebugPanel=function(t){function e(){var e=t.call(this)||this;e.skinName="Setting";var i=e;return e.btn_close.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.parent.removeChild(i)}.bind(e),e),e.btn_ok.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var t=parseFloat(i.label_gravity.text);null!=t&&(HitConst.Gravity=t),t=parseFloat(i.label_max_x.text),null!=t&&(HitConst.Max_Speed_X=t),t=parseFloat(i.label_min_y.text),null!=t&&(HitConst.MIN_SPEED_Y=t),t=parseFloat(i.label_impluse_y.text),null!=t&&(HitConst.PUSH_DOWN_IMPLUSE_Y=t),t=parseFloat(i.label_wind.text),null!=t?HitConst.Frame_Speed_X=t:console.log("##new_value####is nil######",t),t=parseFloat(i.label_floor_restitution.text),null!=t&&(HitConst.floor_restitution=t),t=parseFloat(i.label_right_restitution.text),null!=t&&(HitConst.basket_right_line_restitution=t),t=parseFloat(i.label_left_restitution.text),null!=t&&(HitConst.basket_left_line_restitution=t),t=parseFloat(i.label_board_restitution.text),null!=t&&(HitConst.basket_board_restitution=t),i.parent.removeChild(i)}.bind(e),e),e.btn_reset.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.label_gravity.text=HitConst.BACK_Gravity.toString(),this.label_max_x.text=HitConst.BACK_Max_Speed_X.toString(),this.label_min_y.text=HitConst.BACK_MIN_SPEED_Y.toString(),this.label_impluse_y.text=HitConst.BACK_PUSH_DOWN_IMPLUSE_Y.toString(),this.label_wind.text=HitConst.BACK_Frame_Speed_X.toString(),this.label_floor_restitution.text=HitConst.BACK_floor_restitution.toString(),this.label_right_restitution.text=HitConst.BACK_basket_right_line_restitution.toString(),this.label_left_restitution.text=HitConst.BACK_basket_left_line_restitution.toString(),this.label_board_restitution.text=HitConst.BACK_basket_board_restitution.toString()}.bind(e),e),e.label_gravity.text=HitConst.Gravity.toString(),e.label_max_x.text=HitConst.Max_Speed_X.toString(),e.label_min_y.text=HitConst.MIN_SPEED_Y.toString(),e.label_impluse_y.text=HitConst.PUSH_DOWN_IMPLUSE_Y.toString(),e.label_wind.text=HitConst.Frame_Speed_X.toString(),e.label_floor_restitution.text=HitConst.floor_restitution.toString(),e.label_right_restitution.text=HitConst.basket_right_line_restitution.toString(),e.label_left_restitution.text=HitConst.basket_left_line_restitution.toString(),e.label_board_restitution.text=HitConst.basket_board_restitution.toString(),e}return __extends(e,t),e}(eui.Component);__reflect(DebugPanel.prototype,"DebugPanel");var HitConst=function(){function t(){}return t.getHitRestitution=function(e){return e==HitType.Floor?t.floor_restitution:e==HitType.Right_Line?t.basket_right_line_restitution:e==HitType.Left_Line?t.basket_left_line_restitution:e==HitType.Board?t.basket_board_restitution:e==HitType.Board_Top?t.basket_board_top_down_restitution:e==HitType.Board_Left_Right?t.basket_board_restitution:1},t.getHitFriction=function(e){return e==HitType.Floor?t.floor_friction:e==HitType.Right_Line?t.basket_right_line_friction:e==HitType.Left_Line?t.basket_left_line_friction:e==HitType.Board?t.basket_board_friction:e==HitType.Board_Top?t.basket_board_friction:e==HitType.Board_Left_Right?t.basket_board_friction:1},t.SwapPoint=function(t,e){var i=t.x,a=t.y;t.x=e.x,t.y=e.y,e.x=i,e.y=a},t.SwapPointXY=function(t,e){var i=e.x,a=t.y,n=t.x,l=e.y;t.x=i,t.y=a,e.x=n,e.y=l},t.floor_restitution=-.7,t.floor_friction=1,t.basket_right_line_restitution=-.5,t.basket_right_line_friction=1,t.basket_left_line_restitution=-.5,t.basket_left_line_friction=1,t.basket_board_restitution=-.26,t.basket_board_friction=1,t.basket_board_top_down_restitution=-.7,t.Factor=8,t.Gravity=9.8,t.Max_Speed_X=6*t.Factor,t.MIN_SPEED_Y=-20*t.Factor,t.PUSH_DOWN_IMPLUSE_Y=-20*t.Factor,t.Frame_Speed_X=0*t.Factor,t.BACK_Gravity=t.Gravity,t.BACK_Max_Speed_X=t.Max_Speed_X,t.BACK_MIN_SPEED_Y=t.MIN_SPEED_Y,t.BACK_PUSH_DOWN_IMPLUSE_Y=t.PUSH_DOWN_IMPLUSE_Y,t.BACK_Frame_Speed_X=t.Frame_Speed_X,t.BACK_floor_restitution=t.floor_restitution,t.BACK_basket_right_line_restitution=t.basket_right_line_restitution,t.BACK_basket_left_line_restitution=t.basket_left_line_restitution,t.BACK_basket_board_restitution=t.basket_board_restitution,t}();__reflect(HitConst.prototype,"HitConst");var HitType;!function(t){t[t.Floor=0]="Floor",t[t.Right_Line=1]="Right_Line",t[t.Left_Line=2]="Left_Line",t[t.Board=3]="Board",t[t.Board_Left_Right=4]="Board_Left_Right",t[t.Board_Top=5]="Board_Top",t[t.None=6]="None"}(HitType||(HitType={}));var HitManager=function(){function t(t){this._isOnFloor=!1,this._hitType=HitType.None,this._global_right_line_circle_point=new egret.Point,this._global_right_line_radius=0,this._global_left_line_circle_point=new egret.Point,this._global_left_line_radius=0,this._global_board_top_circle_point=new egret.Point,this._global_borad_top_radius=0,this._global_board_down_circle_point=new egret.Point,this._global_borad_down_radius=0,this.mainPanel=t}return t.prototype.IsOnFloor=function(){return this._isOnFloor},t.prototype.GetHitType=function(){return this._hitType},t.prototype._getLastHitType=function(){return this.mainPanel.GetPlayerBall().getLastHitType()},t.prototype.EnterNextRound=function(){var t=new egret.Point;this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_right_line.x+this.mainPanel.m_right_line.width,this.mainPanel.m_right_line.y,t);var e=new egret.Point;if(this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_right_line.x,this.mainPanel.m_right_line.y,e),this._global_right_line_circle_point.x=(e.x+t.x)/2,this._global_right_line_circle_point.y=(e.y+t.y)/2,0==this._global_right_line_radius){var i=Math.abs(this._global_right_line_circle_point.x-e.x);this._global_right_line_radius=i}var a=new egret.Point;this.mainPanel.m_left_line.parent.localToGlobal(this.mainPanel.m_left_line.x+this.mainPanel.m_left_line.width,this.mainPanel.m_left_line.y,a);var n=new egret.Point;if(this.mainPanel.m_left_line.parent.localToGlobal(this.mainPanel.m_left_line.x,this.mainPanel.m_left_line.y,n),this._global_left_line_circle_point.x=(n.x+a.x)/2,this._global_left_line_circle_point.y=(n.y+a.y)/2,0==this._global_left_line_radius){var l=Math.abs(this._global_left_line_circle_point.x-n.x);this._global_left_line_radius=l}var _=new egret.Point;if(this.mainPanel.m_board_top_circle.localToGlobal(0,0,_),this.mainPanel.m_board_top_circle.localToGlobal(this.mainPanel.m_board_down_circle.width/2,this.mainPanel.m_board_down_circle.height/2,this._global_board_top_circle_point),0==this._global_borad_top_radius){var l=Math.abs(this._global_board_top_circle_point.x-_.x);this._global_borad_top_radius=l}if(_=new egret.Point,this.mainPanel.m_board_down_circle.localToGlobal(0,0,_),this.mainPanel.m_board_down_circle.localToGlobal(this.mainPanel.m_board_down_circle.width/2,this.mainPanel.m_board_down_circle.height/2,this._global_board_down_circle_point),0==this._global_borad_down_radius){var l=Math.abs(this._global_board_down_circle_point.x-_.x);this._global_borad_down_radius=l}},t.prototype.CheckHit=function(){return this._hitType=HitType.None,this.CheckHitFloor()?!0:this.CheckHitRightCirlce()?!0:this.CheckHitLeftCircle()?!0:this.CheckHitBoardCircle()?!0:this.CheckHitBoardLines()?!0:!1},t.prototype.HandleBallHit=function(t,e){var i=HitConst.getHitRestitution(e),a=HitConst.getHitFriction(e),n=new egret.Point(this.mainPanel.GetPlayerBall().basketball_speed_x,this.mainPanel.GetPlayerBall().basketball_speed_y),l=this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.height/2),_=this.mainPanel.m_basket_ball.localToGlobal(t.x,t.y),o=new egret.Point(_.x-l.x,_.y-l.y);o.normalize(1);var s=n.x*o.x+n.y*o.y,r=new egret.Point(s*o.x,s*o.y),h=new egret.Point(n.x-r.x,n.y-r.y),b=new egret.Point(i*r.x,i*r.y),c=new egret.Point(a*h.x,a*h.y),m=new egret.Point(b.x+c.x,b.y+c.y);if(e!=HitType.Floor){if(Math.abs(m.x)<1*HitConst.Factor){var p=1;0!=m.x&&(p=m.x/Math.abs(m.x)),m.x=1*HitConst.Factor*p}if(m.y<0&&Math.abs(m.y)<HitConst.Gravity){var d=-1*HitConst.Gravity-2*HitConst.Factor;m.y=d}}this._hitType=e,this.mainPanel.GetPlayerBall().basketball_speed_x=m.x,this.mainPanel.GetPlayerBall().basketball_speed_y=m.y},t.prototype.CheckHitFloor=function(){var t=this.mainPanel.m_basket_ball.y;return t>=this.mainPanel.m_floor.y-this.mainPanel.m_basket_ball.height?(this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.height),HitType.Floor),this.mainPanel.GetPlayerBall().basketball_speed_x=Math.max(this.mainPanel.GetPlayerBall().basketball_speed_x,-1*HitConst.Max_Speed_X),this.mainPanel.GetPlayerBall().basketball_speed_x=Math.min(this.mainPanel.GetPlayerBall().basketball_speed_x,HitConst.Max_Speed_X),this.mainPanel.HasThisRoundTouch()&&!this.mainPanel.HasGoal()&&(this.mainPanel.IsFaceLeft()?this.mainPanel.GetPlayerBall().basketball_speed_x=-1*HitConst.Max_Speed_X:this.mainPanel.GetPlayerBall().basketball_speed_x=HitConst.Max_Speed_X),this.mainPanel.HasGoal()&&Math.abs(this.mainPanel.GetPlayerBall().basketball_speed_x)<3*HitConst.Factor&&(this.mainPanel.GetPlayerBall().basketball_speed_x=3*HitConst.Factor*this.mainPanel.GetPlayerBall().basketball_speed_x/Math.abs(this.mainPanel.GetPlayerBall().basketball_speed_x)),!0):!1},t.prototype.CheckHitBoardLines=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=new egret.Point;this.mainPanel.m_board_scope.parent.localToGlobal(this.mainPanel.m_board_scope.x,this.mainPanel.m_board_scope.y+20,a);var n=new egret.Point;if(this.mainPanel.m_board_scope.parent.localToGlobal(this.mainPanel.m_board_scope.x+this.mainPanel.m_board_scope.width,this.mainPanel.m_board_scope.y+this.mainPanel.m_board_scope.height-20,n),this.mainPanel.IsFaceLeft()||HitConst.SwapPointXY(a,n),t.x>n.x)return!1;if(e.x<a.x)return!1;if(e.y<a.y)return!1;if(t.y>n.y)return!1;if(i.y>n.y){var l=i.y-n.y,_=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>n.x){if(i.x-n.x>_)return!1}else if(i.x<a.x&&a.x-i.x>_)return!1}else if(i.y<a.y){var l=i.y-a.y,o=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>n.x){if(i.x-n.x>o)return!1}else if(i.x<a.x&&a.x-i.x>o)return!1}i.y<a.y,i.y>n.y;if(i.x<a.x||i.x>n.x){var s=i.x>n.x;return s?this.HandleBallHit(new egret.Point(0,this.mainPanel.m_basket_ball.height/2),HitType.Board_Left_Right):this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.height/2),HitType.Board_Left_Right),!0}return!1},t.prototype.CheckHitBoardCircle=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=Math.abs(i.x-t.x),n=Math.sqrt(Math.pow(i.x-this._global_board_top_circle_point.x,2)+Math.pow(i.y-this._global_board_top_circle_point.y,2));if(n<=this._global_borad_top_radius+a){var l=new egret.Point(this._global_board_top_circle_point.x-i.x,this._global_board_top_circle_point.y-i.y);l.normalize(1);var _=new egret.Point(i.x+l.x*a,i.y+l.y*a),o=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(_.x,_.y,o),this.HandleBallHit(o,HitType.Board_Top),!0}if(n=Math.sqrt(Math.pow(i.x-this._global_board_down_circle_point.x,2)+Math.pow(i.y-this._global_board_down_circle_point.y,2)),n<=this._global_borad_down_radius+a){var l=new egret.Point(this._global_board_down_circle_point.x-i.x,this._global_board_down_circle_point.y-i.y);l.normalize(1);var _=new egret.Point(i.x+l.x*a,i.y+l.y*a),o=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(_.x,_.y,o),this.HandleBallHit(o,HitType.Board_Top),!0}return!1},t.prototype.CheckHitRightCirlce=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=Math.abs(i.x-t.x),n=Math.sqrt(Math.pow(i.x-this._global_right_line_circle_point.x,2)+Math.pow(i.y-this._global_right_line_circle_point.y,2));if(n>this._global_right_line_radius+a)return!1;var l=new egret.Point(this._global_right_line_circle_point.x-i.x,this._global_right_line_circle_point.y-i.y);l.normalize(1);var _=new egret.Point(i.x+l.x*a,i.y+l.y*a),o=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(_.x,_.y,o),this.HandleBallHit(o,HitType.Right_Line),!0},t.prototype.CheckHitLeftCircle=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=Math.abs(i.x-t.x),n=Math.sqrt(Math.pow(i.x-this._global_left_line_circle_point.x,2)+Math.pow(i.y-this._global_left_line_circle_point.y,2));if(n>this._global_left_line_radius+a)return!1;var l=new egret.Point(this._global_left_line_circle_point.x-i.x,this._global_left_line_circle_point.y-i.y);l.normalize(1);var _=new egret.Point(i.x+l.x*a,i.y+l.y*a),o=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(_.x,_.y,o),this.HandleBallHit(o,HitType.Left_Line),!0},t.prototype.CheckHitRightLine=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=new egret.Point;this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_right_line.x+this.mainPanel.m_right_line.width,this.mainPanel.m_right_line.y,a);var n=new egret.Point;if(this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_right_line.x,this.mainPanel.m_right_line.y,n),this.mainPanel.IsFaceLeft()||HitConst.SwapPoint(a,a),t.x>a.x)return!1;if(e.x<n.x)return!1;if(e.y<n.y)return!1;if(t.y>n.y)return!1;var l=i.y-n.y,_=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>a.x){if(i.x-a.x>_)return!1}else if(i.x<n.x&&n.x-i.x>_)return!1;if(i.x>a.x){var o=new egret.Point(i.x-_,n.y),s=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(o.x,o.y,s),this.HandleBallHit(s,HitType.Right_Line),!0}if(i.x<n.x){var o=new egret.Point(i.x+_,n.y),s=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(o.x,o.y,s),this.HandleBallHit(s,HitType.Right_Line),!0}return this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.height),HitType.Right_Line),!0},t.prototype.CheckLeftLine=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=new egret.Point;this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_left_line.x+this.mainPanel.m_left_line.width,this.mainPanel.m_left_line.y,a);var n=new egret.Point;if(this.mainPanel.m_right_line.parent.localToGlobal(this.mainPanel.m_left_line.x,this.mainPanel.m_left_line.y,n),this.mainPanel.IsFaceLeft()||HitConst.SwapPoint(a,n),t.x>a.x)return!1;if(e.x<n.x)return!1;if(e.y<n.y)return!1;if(t.y>n.y)return!1;var l=i.y-n.y,_=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>a.x){if(i.x-a.x>_)return!1}else if(i.x<n.x&&n.x-i.x>_)return!1;if(this.mainPanel.IsFaceLeft()){if(i.x>a.x){var o=new egret.Point(i.x-_,a.y),s=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(o.x,o.y,s),this.HandleBallHit(s,HitType.Left_Line),!0}}else if(i.x<n.x){var o=new egret.Point(i.x+_,a.y),s=new egret.Point;return this.mainPanel.m_basket_ball.globalToLocal(o.x,o.y,s),this.HandleBallHit(s,HitType.Left_Line),!0}return!1},t.prototype.CheckHitBoard=function(){var t=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(0,0,t);var e=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.width,e);var i=new egret.Point;this.mainPanel.m_basket_ball.localToGlobal(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.width/2,i);var a=new egret.Point;this.mainPanel.m_board_scope.parent.localToGlobal(this.mainPanel.m_board_scope.x,this.mainPanel.m_board_scope.y,a);var n=new egret.Point;if(this.mainPanel.m_board_scope.parent.localToGlobal(this.mainPanel.m_board_scope.x+this.mainPanel.m_board_scope.width,this.mainPanel.m_board_scope.y+this.mainPanel.m_board_scope.height,n),this.mainPanel.IsFaceLeft()||HitConst.SwapPointXY(a,n),t.x>n.x)return!1;if(e.x<a.x)return!1;if(e.y<a.y)return!1;if(t.y>n.y)return!1;if(i.y>n.y){var l=i.y-n.y,_=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>n.x){if(i.x-n.x>_)return!1}else if(i.x<a.x&&a.x-i.x>_)return!1}else if(i.y<a.y){var l=i.y-a.y,o=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2));if(i.x>n.x){if(i.x-n.x>o)return!1}else if(i.x<a.x&&a.x-i.x>o)return!1}var s=i.y<a.y,r=i.y>n.y;if(i.x<a.x||i.x>n.x){var h=i.x>n.x;if(s||r){var l=0,b=0;s?(l=i.y-a.y,b=a.y):(l=i.y-n.y,b=n.y);var c=Math.sqrt(Math.pow(this.mainPanel.m_basket_ball.width/2,2)-Math.pow(l,2)),m=new egret.Point(i.x+c,b);h&&(m.x=i.x-c);var p=new egret.Point;this.mainPanel.m_basket_ball.globalToLocal(m.x,m.y,p),this.HandleBallHit(p,HitType.Board)}else h?this.HandleBallHit(new egret.Point(0,this.mainPanel.m_basket_ball.height/2),HitType.Board_Left_Right):this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width,this.mainPanel.m_basket_ball.height/2),HitType.Board_Left_Right)}else if(s)this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width/2,this.mainPanel.m_basket_ball.height),HitType.Board_Top);else{if(!r)return!1;this.HandleBallHit(new egret.Point(this.mainPanel.m_basket_ball.width/2,0),HitType.Board_Top)}return!0},t}();__reflect(HitManager.prototype,"HitManager");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),this.startAnimation(t),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var a=new eui.Theme("resource/default.thm.json",t.stage);a.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var a=new egret.Shape;a.graphics.beginFill(0,.5),a.graphics.drawRect(0,0,e,172),a.graphics.endFill(),a.y=33,this.addChild(a);var n=this.createBitmapByName("egret_icon_png");this.addChild(n),n.x=26,n.y=33;var l=new egret.Shape;l.graphics.lineStyle(2,16777215),l.graphics.moveTo(0,0),l.graphics.lineTo(0,117),l.graphics.endFill(),l.x=172,l.y=61,this.addChild(l);var _=new egret.TextField;_.textColor=16777215,_.width=e-172,_.textAlign="center",_.text="Hello Egret",_.size=24,_.x=172,_.y=80,this.addChild(_);var o=new egret.TextField;this.addChild(o),o.alpha=0,o.width=e-172,o.textAlign=egret.HorizontalAlign.CENTER,o.size=24,o.textColor=16777215,o.x=172,o.y=135,this.textfield=o;var s=new eui.Button;s.label="Click!",s.horizontalCenter=0,s.verticalCenter=0,this.addChild(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,a=t.map(function(t){return i.parse(t)}),n=this.textfield,l=-1,_=function(){l++,l>=a.length&&(l=0);var t=a[l];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(_,e)};_()},e.prototype.onButtonClick=function(t){var e=new MainScenePanel;this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var MainScenePanel=function(t){function e(){var e=t.call(this)||this;return e._isUsingMi=!0,e._auto_enter_next_round=!1,e._is_first_round=!0,e._hasTouchBegin=!1,e._hasThisRoundTouch=!1,e._is_face_left=!0,e._has_goal=!1,e.skinName="MainScene",e.addEventListener(egret.Event.ADDED_TO_STAGE,e._onAddToStage,e),e}return __extends(e,t),e.prototype._onAddToStage=function(t){this.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.m_container.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this);var e=this;this.btn_debug.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var i=new DebugPanel;e.addChild(i),t.stopPropagation()}.bind(this),this),this._initGame()},e.prototype.HasTouchBegin=function(){return this._hasTouchBegin},e.prototype.GetHitManagerMi=function(){return this._hitManager},e.prototype.HasThisRoundTouch=function(){return this._hasThisRoundTouch},e.prototype._initGame=function(){this._hitManager=new HitManager(this),this._playerBall=new PlayerBall(this.m_basket_ball,this),this._left_basket_container_x=this.m_basket_container_back.x,this._left_basket_container_y=this.m_basket_container_back.y,this._right_basket_container_x=this.stage.stageWidth,this._right_basket_container_y=this._left_basket_container_y,this._nextRound()},e.prototype.IsFaceLeft=function(){return this._is_face_left},e.prototype.HasGoal=function(){return this._has_goal},e.prototype.SetGoal=function(t){this._has_goal=t},e.prototype.AutoEnterNextRound=function(){this._auto_enter_next_round=!0},e.prototype.IsInAutoEnterNextRound=function(){return this._auto_enter_next_round},e.prototype.GetPlayerBall=function(){return this._playerBall},e.prototype._nextRound=function(){if(this.SetGoal(!1),this._is_face_left=0==Math.floor(2*Math.random()),this._is_first_round&&(this._is_face_left=!0),this._hasThisRoundTouch=!1,this._is_face_left?(this.m_basket_container_pre.x=this._left_basket_container_x,this.m_basket_container_pre.y=this._left_basket_container_y,this.m_basket_container_pre.scaleX=Math.abs(this.m_basket_container_back.scaleX),this.m_basket_container_back.x=this._left_basket_container_x,this.m_basket_container_back.y=this._left_basket_container_y,this.m_basket_container_back.scaleX=Math.abs(this.m_basket_container_back.scaleX)):(this.m_basket_container_pre.x=this._right_basket_container_x,this.m_basket_container_pre.y=this._right_basket_container_y,this.m_basket_container_pre.scaleX=-1*Math.abs(this.m_basket_container_back.scaleX),this.m_basket_container_back.x=this._right_basket_container_x,this.m_basket_container_back.y=this._right_basket_container_y,this.m_basket_container_back.scaleX=-1*Math.abs(this.m_basket_container_back.scaleX)),this._is_first_round){var t=this.stage.stageWidth/2-this.m_basket_ball.width/2,e=this.m_floor.y-200;this.m_basket_ball.x=t,this.m_basket_ball.y=e}this._is_first_round=!1,this.validateNow(),this._hitManager.EnterNextRound(),this._playerBall.EnterNextRound()},e.prototype._onEnterFrame=function(t){this._auto_enter_next_round&&(this._nextRound(),this._auto_enter_next_round=!1),this._playerBall.Update()},e.prototype._onTouchBegin=function(t){this._hasTouchBegin||(this._hasTouchBegin=!0),this._hasThisRoundTouch=!0,this.m_basket_ball.y<=this.m_top.y||this._playerBall.OnPushDown()},e}(eui.Component);__reflect(MainScenePanel.prototype,"MainScenePanel");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PlayerBall=function(){function t(t,e){this._tweenDir=0,this._last_x=0,this._last_y=0,this._rotate_time=.8,this._last_hit_type=HitType.None,this._push_acce_y=0,this.basketball_speed_x=0,this.basketball_speed_y=0,this.m_basket_ball=t,this.mainPanel=e,this._hitManager=e.GetHitManagerMi()}return t.prototype._updateRotationTween=function(){return this.mainPanel.HasTouchBegin()?0==this._tweenDir?void(this.basketball_speed_x<0?(egret.Tween.get(this.mainPanel.m_image_ball,{loop:!0}).to({rotation:-180},1e3*this._rotate_time).to({rotation:-360},1e3*this._rotate_time),this._tweenDir=-1):(egret.Tween.get(this.mainPanel.m_image_ball,{loop:!0}).to({rotation:180},1e3*this._rotate_time).to({rotation:360},1e3*this._rotate_time),this._tweenDir=1)):void(this.basketball_speed_x<0&&this._tweenDir>0?(this.mainPanel.m_image_ball.rotation=0,this._tweenDir=-1,egret.Tween.removeTweens(this.mainPanel.m_image_ball),egret.Tween.get(this.mainPanel.m_image_ball,{loop:!0}).to({rotation:-180},1e3*this._rotate_time).to({rotation:-360},1e3*this._rotate_time)):this.basketball_speed_x>0&&this._tweenDir<0&&(this._tweenDir=1,this.mainPanel.m_image_ball.rotation=0,egret.Tween.removeTweens(this.mainPanel.m_image_ball),egret.Tween.get(this.mainPanel.m_image_ball,{loop:!0}).to({rotation:180},1e3*this._rotate_time).to({rotation:360},1e3*this._rotate_time))):void 0},t.prototype._adjustBallPosition=function(){var t=!1,e=0;this.mainPanel.m_basket_ball.x<0-this.mainPanel.m_basket_ball.width?(e=this.mainPanel.m_basket_ball.x+this.mainPanel.stage.stageWidth,t=!0):this.mainPanel.m_basket_ball.x>this.mainPanel.stage.stageWidth&&(e=this.mainPanel.m_basket_ball.x-this.mainPanel.stage.stageWidth,t=!0),t&&(this.mainPanel.m_basket_ball.x=e,this.mainPanel.HasGoal()&&(this.mainPanel.m_basket_ball.y=this.mainPanel.m_floor.y-this.mainPanel.m_basket_ball.height-50-50*Math.random(),this.mainPanel.AutoEnterNextRound()))},t.prototype._adjustSpeed=function(){this.mainPanel.HasThisRoundTouch()&&!this.mainPanel.HasGoal()&&(this.mainPanel.IsFaceLeft()?(this.basketball_speed_x>-1*HitConst.Max_Speed_X&&(this.basketball_speed_x-=HitConst.Frame_Speed_X),this.basketball_speed_x=Math.max(this.basketball_speed_x,-1*HitConst.Max_Speed_X)):(this.basketball_speed_x<HitConst.Max_Speed_X&&(this.basketball_speed_x+=HitConst.Frame_Speed_X),this.basketball_speed_x=Math.min(this.basketball_speed_x,HitConst.Max_Speed_X)))},t.prototype._checkGoal=function(t,e){var i=this.mainPanel.m_circle_scope.parent.localToGlobal(this.mainPanel.m_circle_scope.x,this.mainPanel.m_circle_scope.y),a=this.mainPanel.m_circle_scope.parent.localToGlobal(this.mainPanel.m_circle_scope.x+this.mainPanel.m_circle_scope.width,this.mainPanel.m_circle_scope.y+this.mainPanel.m_circle_scope.height);this.mainPanel.IsFaceLeft()||HitConst.SwapPointXY(i,a);var n=this.mainPanel.m_basket_ball.parent.localToGlobal(t.x,t.y),l=this.mainPanel.m_basket_ball.parent.localToGlobal(t.x+this.m_basket_ball.width,t.y+this.m_basket_ball.height),_=new egret.Point((n.x+l.x)/2,(n.y+l.y)/2);if(this._last_x=this.m_basket_ball.x,this._last_y=this.m_basket_ball.y,n.x<i.x-10||l.x>a.x+10)return!1;var o=this.mainPanel.m_basket_ball.parent.localToGlobal(e.x,e.y),s=this.mainPanel.m_basket_ball.parent.localToGlobal(e.x+this.m_basket_ball.width,e.y+this.m_basket_ball.height),r=new egret.Point((o.x+s.x)/2,(o.y+s.y)/2);if(o.x<i.x-10||s.x>a.x+10)return!1;var h=new egret.Point((i.x+a.x)/2,(i.y+a.y)/2);return _.y<=h.y&&r.y>=h.y?(console.log("#########进球了###"),!0):!1},t.prototype._isCurrentInCricleScope=function(){var t=this.mainPanel.m_circle_scope.parent.localToGlobal(this.mainPanel.m_circle_scope.x,this.mainPanel.m_circle_scope.y),e=this.mainPanel.m_circle_scope.parent.localToGlobal(this.mainPanel.m_circle_scope.x+this.mainPanel.m_circle_scope.width,this.mainPanel.m_circle_scope.y+this.mainPanel.m_circle_scope.height);
this.mainPanel.IsFaceLeft()||HitConst.SwapPointXY(t,e);var i=this.mainPanel.m_basket_ball.parent.localToGlobal(this.m_basket_ball.x,this.m_basket_ball.y),a=this.mainPanel.m_basket_ball.parent.localToGlobal(this.m_basket_ball.x+this.m_basket_ball.width,this.m_basket_ball.y+this.m_basket_ball.height);return i.x<t.x-10||a.x>e.x+10?!1:!0},t.prototype.EnterNextRound=function(){},t.prototype.OnPushDown=function(){this.basketball_speed_y>0&&(this.basketball_speed_y=0),this._push_acce_y=HitConst.PUSH_DOWN_IMPLUSE_Y,this.basketball_speed_x=HitConst.Max_Speed_X*(this.mainPanel.IsFaceLeft()?-1:1)},t.prototype.Update=function(){this._adjustSpeed(),this._updateRotationTween(),this._adjustBallPosition();var t=HitConst.Gravity+this._push_acce_y;this.basketball_speed_y+=t,this.basketball_speed_y=Math.max(this.basketball_speed_y,HitConst.MIN_SPEED_Y),this._push_acce_y=0;for(var e=Math.sqrt(Math.pow(this.basketball_speed_x,2)+Math.pow(this.basketball_speed_y,2))/HitConst.Factor,i=2,a=Math.ceil(e/i),n=this.basketball_speed_x/a,l=this.basketball_speed_y/a,_=this._isCurrentInCricleScope(),o=this.mainPanel.HasGoal(),s=1;a>=s;s++){var r=this.m_basket_ball.x,h=this.m_basket_ball.y;this.m_basket_ball.x+=n/HitConst.Factor,this.m_basket_ball.y+=l/HitConst.Factor;var b=this._hitManager.CheckHit();if(b){if(this.m_basket_ball.x=r,this.m_basket_ball.y=h,this._hitManager.GetHitType()!=HitType.Floor){var c=(this._hitManager.GetHitType(),(a-s)/a),m=Math.sqrt(Math.pow(this.basketball_speed_x,2)+Math.pow(this.basketball_speed_y,2))/HitConst.Factor;0==c&&(c=1),m*=c;var p=Math.min(m,5),d=this.basketball_speed_x*c/HitConst.Factor*p/m,u=this.basketball_speed_y*c/HitConst.Factor*p/m;this.m_basket_ball.x+=d,this.m_basket_ball.y+=u}break}_&&(o||(o=this._checkGoal(new egret.Point(r,h),new egret.Point(this.m_basket_ball.x,this.m_basket_ball.y)),o&&this.mainPanel.SetGoal(!0)))}this._hitManager.GetHitType()==HitType.Floor&&(this.m_basket_ball.x+=this.basketball_speed_x/HitConst.Factor),this._last_hit_type=this._hitManager.GetHitType()},t.prototype.getLastHitType=function(){return this._last_hit_type},t}();__reflect(PlayerBall.prototype,"PlayerBall");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,a){function n(t){e.call(a,t)}function l(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,l,null),i.call(a))}var _=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(a,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(a,generateEUI2)},_)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var s=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(a,generateJSON.paths[t])},this):RES.getResByUrl(s,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(a,generateJSON.paths[t])},_)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(a,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,l,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);