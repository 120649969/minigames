var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{_(i.next(t))}catch(e){r(e)}}function s(t){try{_(i["throw"](t))}catch(e){r(e)}}function _(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}_((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;_;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return _.label++,{value:n[1],done:!1};case 5:_.label++,r=n[1],n=[0];continue;case 7:n=_.ops.pop(),_.trys.pop();continue;default:if(a=_.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){_=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){_.label=n[1];break}if(6===n[0]&&_.label<a[1]){_.label=a[1],a=n;break}if(a&&_.label<a[2]){_.label=a[2],_.ops.push(n);break}a[2]&&_.ops.pop(),_.trys.pop();continue}n=e.call(t,_)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,_={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},io;!function(t){var e=function(){function t(){this.socket=new egret.WebSocket,this.ssl=!1,this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onMessage,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.name="",this.url="",this.protocol={},this.protocolCallback={},this.regProtocol(t.COMMON_PROTOCOL),this.closeFlag=!1,this.reconnectFlag=!1,this.logHeartbeat=!1}return t.prototype.regProtocol=function(t){for(var e in t)this.protocol[e]=t[e];this.protocolReverse={};for(var e in this.protocol)this.protocolReverse[this.protocol[e]]=e},t.prototype.connect=function(t){if(this.socket.connected)return void console.error("connect: socket connected already");this.url=t;var e="ws"+(this.ssl?"s":"")+"://"+t;console.log(this.name,"connect to",e),this.socket.connectByUrl(e)},t.prototype.disconnect=function(){return this.socket.connected?(this.closeFlag=!0,this.socket.close(),void(this.protocolCallback={})):void console.error("disconnect: socket not connected")},t.prototype.onError=function(t){console.error("socket error"),"function"==typeof this.onSocketErrorCb&&(this.onSocketErrorCb(),this.onSocketErrorCb=null)},t.prototype.onSocketOpen=function(t){console.log(this.name,"connected"),this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(this.heartbeatRoutine.bind(this),Const.HEARTBEAT_DUR),"function"==typeof this.onConnected&&(this.onConnected(),this.onConnected=null),this.reconnectFlag&&this.onReconnected()},t.prototype.onMessage=function(t){var e=this.socket.readUTF();if(0!=e.length){var n;try{n=Util.parseNetObject(e)}catch(i){return void console.error(i)}var o=n.MsgId,r=n.Body;if(this.logProtocol(o,r),2==o){n=Util.parseNetObject(e)}if(o>=0){var a=this.protocolCallback[o];a?(a(o,r),delete this.protocolCallback[this.protocolCallback[o]]):1e3>o&&console.warn("["+this.name+"]","no callback found",o)}else r=Util.parseNetObject(r)}},t.prototype.onSocketClose=function(t){if(console.log(this.name,"disconnected"),this.closeFlag||setTimeout(this.reconnect.bind(this),3e3),this.closeFlag=!1,this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),"function"==typeof this.onDisconnected){var e=this.onDisconnected;this.onDisconnected=null,e()}},t.prototype.logProtocol=function(e,n){if(this.logHeartbeat||e!=t.COMMON_PROTOCOL.CMD_COMMON_HEART_BEAT_REQ&&e!=t.COMMON_PROTOCOL.CMD_COMMON_HEART_BEAT_RSP){if(!this.protocolReverse){this.protocolReverse={};for(var i in this.protocol)this.protocolReverse[this.protocol[i]]=i}var o="["+Util.formatDateTimeFull(new Date)+"]";this.protocolReverse[e]?console.log(o,"protocol",this.protocolReverse[e],e,"body",n):console.log(o,"protocol",e,"body",n)}},t.prototype.send=function(t,e){if(!this.socket.connected)return void console.log("send: socket not connected");if("string"==typeof t){var n=this.protocol[t];if(!n)return void console.error("protocol not found",t);t=n}e&&0!=Object.keys(e).length||(e={empty:!0});var i=JSON.stringify({MsgId:t,Body:JSON.stringify(e)});this.socket.writeUTF(i),this.logProtocol(t,e)},t.prototype.isConnected=function(){return this.socket.connected},t.prototype.on=function(t,e){this.protocolCallback[t]=e},t.prototype.off=function(t){delete this.protocolCallback[t]},t.prototype.clearCallback=function(){this.protocolCallback={}},t.prototype.heartbeatRoutine=function(){this.send(t.COMMON_PROTOCOL.CMD_COMMON_HEART_BEAT_REQ,null)},t.prototype.reconnect=function(){this.reconnectFlag=!0},t.prototype.onReconnected=function(){},t.COMMON_PROTOCOL={CMD_COMMON_REMOTE_LOGIN_PUSH:1e6,CMD_COMMON_HEART_BEAT_REQ:1000001,CMD_COMMON_HEART_BEAT_RSP:1000002,CMD_COMPRESS_REQ:1000003,CMD_COMPRESS_RSP:1000004},t}();t.Net=e,__reflect(e.prototype,"io.Net")}(io||(io={}));var ui;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.tweening=!1,t.name="",t.showLayer=n.SHOW_LAYER_UI,t.externalCloseSwitch=!1,t.param=null,t.touchEnabled=!1,t.resizeWy=!0,t}return __extends(n,e),n.prototype.resizeStage=function(){if(this.stage){var t=this.stage.stageWidth,e=this.stage.stageHeight;this.width=t,this.height=e;var n=Const.MIN_WIDTH/Const.MIN_HEIGHT,i=this.imgBg;if(i){var o=t,r=e,a=o/r,s=0,_=0;a>n?(r=o/n,_=Math.floor((e-r)/2),r=Math.ceil(r)):n>a&&(o=r*n,s=Math.floor((t-o)/2),o=Math.ceil(o)),i.width=o,i.height=r,i.x=s,i.y=_}}},n.prototype.onOpen=function(){if(EventEmitter.getInstance().addEventListener(Const.EVENT.ON_STAGE_RESIZE,this.resizeStage,this),this.resizeStage(),this.tweening){var t=this.root;if(t){t.scaleX=.05,t.scaleY=.05;var e=egret.Tween.get(t);e.to({scaleX:1,scaleY:1},300,egret.Ease.sineInOut)}}Util.updateLanguage(this,this.resizeWy)},n.prototype.onClose=function(){var t=this.root;t&&egret.Tween.removeTweens(t),EventEmitter.getInstance().removeEventListener(Const.EVENT.ON_STAGE_RESIZE,this.resizeStage,this)},n.prototype.close=function(){t.WindowManager.getInstance().close(this.name)},n.prototype.refresh=function(){},n.prototype.setBgTapEvent=function(t){var e=this.imgBg;e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"function"==typeof t&&t()},this)},n.SHOW_LAYER_UI=1,n.SHOW_LAYER_COVER=2,n.SHOW_LAYER_TOP=3,n}(eui.Component);t.Window=e,__reflect(e.prototype,"ui.Window")}(ui||(ui={}));var BaseGameObject=function(t){function e(){var e=t.call(this)||this;return e.degree_on_plate=0,e}return __extends(e,t),e}(eui.Component);__reflect(BaseGameObject.prototype,"BaseGameObject");var PropObject=function(t){function e(){var e=t.call(this)||this;return e.skinName="PropSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=KnifeUtils.createDragonBones("prop_ske_json","prop_tex_json","prop_tex_png","prop_armature");this.addChild(e),e.x=this.width/2,e.y=this.height/2,e.visible=!1,this._prop_armature=e;var n=this;e.addDBEventListener(dragonBones.AnimationEvent.COMPLETE,function(){n.visible=!1},this),e.rotation=180},e.prototype.PlayBrokenAnimation=function(){this.img.visible=!1,this._prop_armature.visible=!0,this._prop_armature.animation.play("prop_animation",1)},e}(BaseGameObject);__reflect(PropObject.prototype,"PropObject");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function o(t){e.call(i,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var _=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(_,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Config=function(){function t(){}return t.setConfig=function(e,n){t[e]=n},t.getConfig=function(e){return t[e]},t.platform="",t.enableBgm=!0,t.enableSound=!0,t.lang="wy",t.debug=0,t.maintain=0,t}();__reflect(Config.prototype,"Config");var Const=function(){function t(){}return t.MIN_RESOLUTION=720,t.MIN_WIDTH=720,t.MIN_HEIGHT=1280,t.HEARTBEAT_DUR=6e3,t.GAME_TIME=90,t.DEBUG_SERVER_URL="ght-hall.badambiz.com:50003",t.RELEASE_SERVER_URL="ght-hall.badambiz.com:50003",t.EVENT={ON_STAGE_RESIZE:"onStageResize",ON_WINDOW_OPEN:"onWindowOpen",ON_WINDOW_CLOSED:"onWindowClosed"},t.StageWidth=0,t.StageHeight=0,t}();__reflect(Const.prototype,"Const");var EventEmitter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.instance||(this.instance=new e),this.instance},e.instance=null,e}(egret.EventDispatcher);__reflect(EventEmitter.prototype,"EventEmitter");var GamePlatform=function(){function t(){}return t.onInit=function(){"undefined"!=typeof bdm&&bdm.pk.onInit()},t.onWaiting=function(t){"undefined"!=typeof bdm&&bdm.pk.onWaiting(t)},t.onStarted=function(t){"undefined"!=typeof bdm&&bdm.pk.onStarted(t)},t.onFinished=function(){"undefined"!=typeof bdm&&bdm.pk.onFinished()},t.GetIcon=function(){"undefined"!=typeof bdm&&"undefined"!=typeof bdm.args&&console.log(bdm.args)},t.GetMyOpenId=function(){return"undefined"!=typeof bdm&&"undefined"!=typeof bdm.args?bdm.args.openid:""},t.GetRoomId=function(){return"undefined"!=typeof bdm&&"undefined"!=typeof bdm.args?(console.log(bdm.args.roomid),bdm.args.roomid):""},t.registerSurrenderCallback=function(t){"undefined"!=typeof bdm&&"undefined"!=typeof bdm.args&&bdm.pk.onUserExit(function(){t&&t()})},t}();__reflect(GamePlatform.prototype,"GamePlatform");var User=function(){function t(){}return t.openId="",t.roomId="",t.token=0,t.sessionid=0,t}();__reflect(User.prototype,"User");var Util=function(){function t(){}return t.setButtonTapEvent=function(t,e,n){void 0===n&&(n=null),n=n||t,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.scaleX=.9,this.scaleY=.9},n),t.addEventListener(egret.TouchEvent.TOUCH_END,function(t){this.scaleX=1,this.scaleY=1,"function"==typeof e&&e()},n),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(t){this.scaleX=1,this.scaleY=1},n)},t.parseNetObject=function(t){var e=null;if("string"==typeof t)try{e=JSON.parse(t),"number"==typeof e&&(e=t)}catch(n){e=t}else e=t;if("object"==typeof e)for(var i in e)e[i]=this.parseNetObject(e[i]);return e},t.T=function(t,e){void 0===e&&(e=!0);var n=Config.lang,i=RES.getRes("multi_language_json");if(!i)return"";var o=i[t];if(!o)return"";var r=o[n];return r},t.format=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=t.length){var n=t[0];if("string"!=typeof n)return null;if(1==t.length)return n;for(var i=1;i<t.length;i++)for(var o="{"+i.toString()+"}";n.indexOf(o)>=0;)n=n.replace(o,t[i]);return n}},t.getMultiLanguageRes=function(t){return"cn"!=Config.lang&&(t=Config.lang+"_"+t),RES.getRes(t)},t.updateRes=function(t){if(t&&t.$children)for(var e=0,n=t.$children;e<n.length;e++){var i=n[e];if(i instanceof eui.Image){var o=i;if("string"==typeof o.source){var r=o.source;if("cn"!=Config.lang&&RES.hasRes(Config.lang+"_"+r)){r=Config.lang+"_"+r;var a=RES.getRes(r);a&&(o.source=a)}}}else this.updateRes(i)}},t.updateLanguage=function(e,n){if(void 0===n&&(n=!0),e&&e.$children)for(var i=0,o=e.$children;i<o.length;i++){var r=o[i];if(r instanceof eui.Image){var a=r;if("string"==typeof a.source){var s=a.source;if("cn"!=Config.lang){s=Config.lang+"_"+s;var _=RES.getRes(s);_&&(a.source=s,a.width=_.textureWidth,a.height=_.textureHeight)}}}else if(r instanceof eui.Label){if(r.text&&r.visible&&0==r.text.indexOf("#")){var l=Number(r.text.substring(1));isNaN(l)||(r.text=t.T(l),"wy"==Config.lang&&n&&(r.size=Math.floor(.8*r.size)))}}else this.updateLanguage(r,n)}},t.deepCopy=function(t){if(!t)return null;var e=JSON.stringify(t);return JSON.parse(e)},t.formatDateTime=function(t){function e(t,e){void 0===e&&(e=2);for(var n="",i=t.length;e>i;i++)n+="0";return n+t}var n=t.getFullYear().toString(),i=(t.getMonth()+1).toString(),o=t.getDate().toString(),r=t.getHours().toString(),a=t.getMinutes().toString();return n+"/"+e(i)+"/"+e(o)+" "+e(r)+":"+e(a)},t.formatDateTimeFull=function(t){function e(t,e){void 0===e&&(e=2);for(var n="",i=t.length;e>i;i++)n+="0";return n+t}var n=t.getFullYear().toString(),i=(t.getMonth()+1).toString(),o=t.getDate().toString(),r=t.getHours().toString(),a=t.getMinutes().toString(),s=t.getSeconds().toString(),_=t.getMilliseconds().toString();return n+"/"+e(i)+"/"+e(o)+" "+e(r)+":"+e(a)+":"+e(s)+"."+e(_,3)},t.getUrlParam=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(e);return null!=n?decodeURI(n[2]):null},t.getAllUrlParam=function(){var t={};if(""==window.location.search)return t;for(var e=window.location.search.substring(1),n=e.split("&"),i=[],o=0;o<n.length;o++)i=n[o].split("="),t[i[0]]=i[1]||"";return t},t.getTimeString=function(e){var n=new Date,i=Math.floor((n.getTime()-e.getTime())/1e3);return 60>i?t.T(1000062):i>=60&&3600>i?t.format(t.T(1000063),Math.floor(i/60)):i>=3600&&86400>i?t.format(t.T(1000064),Math.floor(i/3600)):t.format(t.T(1000065),Math.floor(i/86400))},t.rightToLeftWordSplit=function(t){function e(t){for(var e=[" ","\n","(",")","[","]","{","}","【","】",".","-","!","؟"],n=0;n<e.length;n++)if(t==e[n])return!0;return!1}function n(t){return t>="0"&&"9">=t}function i(t,e){for(var n=0;n<e.length;n++)if(t==e[n])return n;return-1}t=t.replace(/\r\n/g,"\n"),t=t.replace(/\t/g,"  ");for(var o,r,a=[],s=0;s<t.length;){o=s,r="";var _=void 0,l=void 0;do _=t[o++],l=e(_),l?"."==_&&n(t[o-2])&&n(t[o])&&(l=!1,r+=_):r+=_;while(!l&&o<t.length);r.length>0&&a.push(r),a.push(_),s=o}var h=["(","[","{","【"],c=[")","]","}","】"];o=-1;for(s=0;s<a.length;s++){var p=i(a[s],h),u=i(a[s],c);if(p>0)o=s;else if(u>0){var d=a[o];a[o]=a[s],a[s]=d,o=-1}}return a},t.sleep=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,n){setTimeout(e,t)})]})})},t}();__reflect(Util.prototype,"Util");var io;!function(t){var e=function(t){function e(){var n=t.call(this)||this;return n.name="GameNet",n.sessionKey=null,n.regProtocol(e.GAME_PROTOCOL),n}return __extends(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connectServer=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this,[2,new Promise(function(e,n){t.onConnected=function(){e()},t.connect(Const.RELEASE_SERVER_URL)})]})})},e.prototype.reqLogin=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){return n=this,[2,new Promise(function(i,o){n.on(e.GAME_PROTOCOL.CMD_H5_LOGIN_RSP,function(t,o){n.off(e.GAME_PROTOCOL.CMD_H5_LOGIN_RSP),i(o)}),n.send(e.GAME_PROTOCOL.CMD_H5_LOGIN_REQ,{openid:User.openId,roomid:t.toString()})})]})})},e.prototype.reqJoin=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){return n=this,[2,new Promise(function(i,o){n.on(e.GAME_PROTOCOL.CMD_H5_JOIN_RSP,function(o,r){n.off(e.GAME_PROTOCOL.CMD_H5_JOIN_RSP),i(r),t&&t(r)}),n.send(e.GAME_PROTOCOL.CMD_H5_JOIN_REQ,{openid:User.openId})})]})})},e.prototype.reqReEnter=function(t,n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){return i=this,[2,new Promise(function(o,r){i.on(e.GAME_PROTOCOL.CMD_H5_REENTER_RSP,function(t,r){i.off(e.GAME_PROTOCOL.CMD_H5_REENTER_RSP),o(r),n&&n(r)}),i.send(e.GAME_PROTOCOL.CMD_H5_REENTER_REQ,{level:t})})]})})},e.prototype.reqShoot=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){return n=this,[2,new Promise(function(i,o){n.on(e.GAME_PROTOCOL.CMD_H5_KNIFE_SHOT_RSP,function(t,o){n.off(e.GAME_PROTOCOL.CMD_H5_KNIFE_SHOT_RSP),i(o)}),n.send(e.GAME_PROTOCOL.CMD_H5_KNIFE_SHOT_REQ,{at:t})})]})})},e.prototype.reqSwitch=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){return n=this,[2,new Promise(function(i,o){n.on(e.GAME_PROTOCOL.CMD_H5_KNIFE_SWITCH_RSP,function(t,o){n.off(e.GAME_PROTOCOL.CMD_H5_KNIFE_SWITCH_RSP),i(o)}),n.send(e.GAME_PROTOCOL.CMD_H5_KNIFE_SWITCH_REQ,{level:t})})]})})},e.prototype.reqUseProp=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){return n=this,[2,new Promise(function(i,o){n.on(e.GAME_PROTOCOL.CMD_H5_KNIFE_USEPROP_RSP,function(t,o){n.off(e.GAME_PROTOCOL.CMD_H5_KNIFE_USEPROP_RSP),i(o)}),n.send(e.GAME_PROTOCOL.CMD_H5_KNIFE_USEPROP_REQ,{prop:t})})]})})},e.prototype.reqSurrend=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){return t=this,[2,new Promise(function(n,i){t.on(e.GAME_PROTOCOL.CMD_H5_SURREND_RSP,function(i,o){t.off(e.GAME_PROTOCOL.CMD_H5_SURREND_RSP),n(o)}),t.send(e.GAME_PROTOCOL.CMD_H5_SURREND_REQ,{})})]})})},e.instance=null,e.GAME_PROTOCOL={CMD_H5_LOGIN_REQ:1,CMD_H5_LOGIN_RSP:2,CMD_H5_JOIN_REQ:3,CMD_H5_JOIN_RSP:4,CMD_H5_REENTER_REQ:5,CMD_H5_REENTER_RSP:6,CMD_H5_SURREND_REQ:7,CMD_H5_SURREND_RSP:8,CMD_H5_KNIFE_SHOT_REQ:1001,CMD_H5_KNIFE_SHOT_RSP:1002,CMD_H5_KNIFE_SWITCH_REQ:1003,CMD_H5_KNIFE_SWITCH_RSP:1004,CMD_H5_KNIFE_USEPROP_REQ:1005,CMD_H5_KNIFE_USEPROP_RSP:1006,CMD_H5_JOIN_PUSH:100,CMD_H5_GAME_STATUS_PUSH:102,CMD_H5_GAME_START_PUSH:104,CMD_H5_SECOND_PUSH:106,CMD_H5_SCORE_PUSH:108,CMD_H5_GAME_OVER_PUSH:110,CMD_H5_REENTER_PUSH:112,CMD_H5_KNIFE_LEVEL_PUSH:1e4,CMD_H5_KNIFE_REFRESH_PUSH:10002,CMD_H5_KNIFE_USEPROP_PUSH:10004},e}(t.Net);t.GameNet=e,__reflect(e.prototype,"io.GameNet")}(io||(io={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SoundManager=function(){function t(){this.bgmChannel=null}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.playSound=function(t){var e=RES.getRes(t);return e?e.play(0,1):null},t.prototype.playBGM=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null);var e=t.BGM_NAME;RES.getResAsync(e,function(t){t?(this.bgmChannel=t.play(0,0),this.bgmChannel.volume=Config.enableBgm?1:0):console.error("bgm not found",e)},this)},t.prototype.stopBgm=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},t.instance=null,t.BGM_NAME="bg_theme_mp3",t}();__reflect(SoundManager.prototype,"SoundManager");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?i(o):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ui;!function(t){var e=function(){function e(){this.windows={}}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.initialize=function(t){this.container=t},e.prototype.createWindow=function(e){var n=t[e];if(!n)return null;var i=new n;return i.name=e,this.windows[e]=i,i},e.prototype.getWindow=function(t){var e=this.windows[t];return e?e:null},e.prototype.open=function(e,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!1),!this.container)return null;var o=this.getWindow(e);if(o)return o;if(o=this.createWindow(e),!o)return null;var r;switch(o.showLayer){case t.Window.SHOW_LAYER_UI:r=this.container.uiLayer;break;case t.Window.SHOW_LAYER_COVER:r=this.container.coverLayer;break;case t.Window.SHOW_LAYER_TOP:r=this.container.topLayer;break;default:r=this.container.uiLayer}return r.contains(o)||(console.log("Open window:",o.name),o.param=n,o.tweening=i,r.addChild(o),o.onOpen(),EventEmitter.getInstance().dispatchEventWith(Const.EVENT.ON_WINDOW_OPEN,!1,o.name)),o},e.prototype.close=function(e){if(this.container){var n=this.windows[e];if(n){var i;switch(n.showLayer){case t.Window.SHOW_LAYER_UI:i=this.container.uiLayer;break;case t.Window.SHOW_LAYER_COVER:i=this.container.coverLayer;break;case t.Window.SHOW_LAYER_TOP:i=this.container.topLayer;break;default:i=this.container.uiLayer}delete this.windows[e],n.onClose(),EventEmitter.getInstance().dispatchEventWith(Const.EVENT.ON_WINDOW_CLOSED,!1,e),i.contains(n)&&(i.removeChild(n),console.log("Window closed:",n.name))}}},e.prototype.closeAllWindow=function(t){void 0===t&&(t=[]);var e=[];t.length>0&&(e=e.concat(t));for(var n=Object.keys(this.windows),i=0;i<n.length;i++){for(var o=!1,r=0;r<e.length;r++)if(e[r]==n[i]){o=!0;break}o||this.close(n[i])}},e.prototype.isWindowOpening=function(t){return!!this.windows[t]},e.instance=null,e}();t.WindowManager=e,__reflect(e.prototype,"ui.WindowManager")}(ui||(ui={}));var RotateDirection;!function(t){t[t.POSITIVE=1]="POSITIVE",t[t.NEGATIVE=-1]="NEGATIVE"}(RotateDirection||(RotateDirection={}));var StrategyConfig=function(){function t(t){this.duration=t.duration,this.direction=t.direction,this.speed=t.speed,this.fadeTime=t.fadeTime||2}return t}();__reflect(StrategyConfig.prototype,"StrategyConfig");var MaterialConfig=function(){function t(t){this.type=0,this.name="",this.degrees=[],this.count=0,this.backup_degrees=[],this._last_generate_degrees=[],this.type=t.type,this.name=t.name,this.count=t.count,this.degrees=t.degree,this.Reset()}return t.prototype.getRandomDegree=function(t){if(this._last_generate_degrees.length>t)return this._last_generate_degrees[t];var e=0,n=Math.floor(Math.random()*this.backup_degrees.length);return e=this.backup_degrees[n],this.backup_degrees.splice(n,1),this._last_generate_degrees.push(e),console.log(this.backup_degrees,e),e},t.prototype.Reset=function(){this.backup_degrees=[];for(var t=0;t<this.degrees.length;t++)this.backup_degrees.push(this.degrees[t])},t}();__reflect(MaterialConfig.prototype,"MaterialConfig");var RoundConfig=function(){function t(t){this.round=0,this.count=0,this.skin=1,this.materialConfigs=[],this.strategys=[],void 0!=t.round&&(this.round=t.round),void 0!=t.count&&(this.count=t.count),void 0!=t.skin&&(this.skin=t.skin);var e=[];void 0!=t.materials&&(e=t.materials);for(var n=0;n<e.length;n++){var i=new MaterialConfig(e[n]);i.count>0&&this.materialConfigs.push(i)}var o=[];void 0!=t.strategys&&(o=t.strategys);for(var n=0;n<o.length;n++){var r=new StrategyConfig(o[n]);r.speed<KnifeConst.InValid_Config_Value&&this.strategys.push(r)}}return t.prototype.Reset=function(){for(var t=0;t<this.materialConfigs.length;t++){var e=this.materialConfigs[t];e.Reset()}},t}();__reflect(RoundConfig.prototype,"RoundConfig");var PlateRotateStrategy=function(){function t(t,e){this.curTime=0,this._current_speed=0,this._target_speed=0,this._target_speed=e,this.speed=t.speed,this.duration=t.duration,this.fadeTime=t.fadeTime,this._current_speed=this.speed}return t.prototype.ReSet=function(){this.curTime=0,this._current_speed=this.speed},t.prototype.Step=function(t){return this.curTime+=t,this.curTime>=this.duration-this.fadeTime&&this.fadeTime>0?this._current_speed=this.speed+(this._target_speed-this.speed)*(this.curTime-this.duration+this.fadeTime)/this.fadeTime:this._current_speed=this.speed,this.direction=this._current_speed>0?RotateDirection.POSITIVE:RotateDirection.NEGATIVE,this.curTime>=this.duration?!0:!1},t.prototype.getCurrentSpeed=function(){return this._current_speed},t}();__reflect(PlateRotateStrategy.prototype,"PlateRotateStrategy");var RoundPlateRotateStrategy=function(){function t(t){this.strategys=[],this.strategyIndex=0,this.maxKnifeCount=0,this.hasChangeStrategy=!1,this.roundConfig=t;for(var e=t.strategys,n=0;n<e.length;n++){var i=e[n],o=e[(n+1)%e.length].speed,r=new PlateRotateStrategy(i,o);this.strategys.push(r)}this.maxKnifeCount=t.count}return t.prototype.Step=function(t){this.hasChangeStrategy=!1;var e=this.strategys[this.strategyIndex];if(e){var n=e.Step(t);n&&(this.strategyIndex=(this.strategyIndex+1)%this.strategys.length);var i=e.getCurrentSpeed();return n&&(this.hasChangeStrategy=!0,e.ReSet()),i}return 0},t.prototype.GetCurrentStrategy=function(){return this.strategys[this.strategyIndex]},t.prototype.GetCurrentStrategyConfig=function(){return this.roundConfig.strategys[this.strategyIndex]},t}();__reflect(RoundPlateRotateStrategy.prototype,"RoundPlateRotateStrategy");var KnifeConst=function(){function t(){}return t.KNIFE_INIT_SPEED=-100,t.KNIFE_ACCE=-40,t.InValid_Config_Value=100,t.Shake_Range=15,t.MAX_BALL_COUNT=4,t.PROP_WIND=1,t.PROP_OTHER_KNIFE=2,t.PROP_DOWN_SPEED=3,t.ALL_PROPS_ARRAY=[t.PROP_WIND,t.PROP_OTHER_KNIFE,t.PROP_DOWN_SPEED],t}();__reflect(KnifeConst.prototype,"KnifeConst");var KnifeObject=function(t){function e(e,n){void 0===n&&(n=!1);var i=t.call(this)||this;return i.is_end=!1,i.lastY=0,i.speedY=0,i.speedX=0,i.acceY=0,i.label_index=0,i.isMe=!0,i.skinName="KnifeSkin",i._mainPanel=e,i._platObject=i._mainPanel.m_plate_object,i.is_end=!1,i.m_img_1.visible=!1,i.m_img_2.visible=!1,i.m_img_3.visible=!1,n?i.m_img_2.visible=!0:e.serverModel.myRole.level%3==0?i.m_img_3.visible=!0:i.m_img_1.visible=!0,i}return __extends(e,t),e.prototype.StartTouchMove=function(){egret.Tween.removeTweens(this),this.speedY=KnifeConst.KNIFE_INIT_SPEED,this.acceY=KnifeConst.KNIFE_ACCE},e.prototype.StartBirthMove=function(t,e){this.x=t,this.y=e},e.prototype.GetStepTimes=function(){var t=this.speedX,e=this.speedY+this.acceY,n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),i=2,o=Math.ceil(n/i);return o},e.prototype.Update=function(){if(!this.is_end)for(var t=this.speedX,e=this.speedY+this.acceY,n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),i=2,o=Math.ceil(n/i),r=t/o,a=e/o,s=1;o>=s;s++){if(this.x+=r,this.y+=a,this._checkHitBall()){this._onHitBall();break}var _=null;if(this.isMe&&(_=this._checkHitProp())){this._onHitOtherProp(_);break}if(this.isMe&&this._checkHitOtherKnife()){this._onHitOtherKnife();break}}},e.prototype.UpdateVersion2=function(t){if(void 0===t&&(t=null),this.is_end)return 1;var e=this.speedX,n=this.speedY+this.acceY,i=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),o=2,r=Math.ceil(i/o);if(0==r)return 1;var a=e/r,s=n/r,_=1;for(_=1;r>=_;_++){if(this.x+=a,this.y+=s,t&&t(1/r),this._checkHitBall()){this._mainPanel.PlayKnifeHitAnimation(this),this._onHitBall();break}var l=null;if(this.isMe&&(l=this._checkHitProp())){this._onHitOtherProp(l);break}if(this.isMe&&this._checkHitOtherKnife()){this._onHitOtherKnife();break}}return 1-_/r},e.prototype._checkHitBall=function(){var t=this._mainPanel.m_plate_object.GetGlobalCenterPoint(),e=this.localToGlobal(this.hit_ball_rect.x+this.hit_ball_rect.width/2,this.hit_ball_rect.y+this.hit_ball_rect.height/2);return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<=this._mainPanel.m_plate_object.m_plate_container.width/2?!0:!1},e.prototype._checkHitOtherKnife=function(){for(var t=this.localToGlobal(this.hit_rect.x,0),e=this.localToGlobal(this.hit_rect.x+this.hit_rect.width,0),n=this._platObject.all_knife_objects,i=0;i<n.length;i++){var o=n[i],r=o.globalToLocal(t.x,t.y);if(r.x>=o.behit_rect.x&&r.x<=o.behit_rect.x+o.behit_rect.width&&r.y>=o.behit_rect.y&&r.y<=o.behit_rect.y+o.behit_rect.height)return!0;var a=o.globalToLocal(e.x,e.y);if(a.x>=o.behit_rect.x&&a.x<=o.behit_rect.x+o.behit_rect.width&&a.y>=o.behit_rect.y&&a.y<=o.behit_rect.y+o.behit_rect.height)return!0}return!1},e.prototype._checkHitProp=function(){for(var t=this.localToGlobal(this.hit_rect.x,0),e=this.localToGlobal(this.hit_rect.x+this.hit_rect.width,0),n=this._platObject.all_prop_objects,i=0;i<n.length;i++){var o=n[i],r=o.globalToLocal(t.x,t.y);if(r.x>=o.behit_rect.x&&r.x<=o.behit_rect.x+o.behit_rect.width&&r.y>=o.behit_rect.y&&r.y<=o.behit_rect.y+o.behit_rect.height)return o;var a=o.globalToLocal(e.x,e.y);if(a.x>=o.behit_rect.x&&a.x<=o.behit_rect.x+o.behit_rect.width&&a.y>=o.behit_rect.y&&a.y<=o.behit_rect.y+o.behit_rect.height)return o}return null},e.prototype._onHitBall=function(){this.is_end=!0;var t=this._platObject.OnHitOtherKnife(this);if(!t){var e=this.localToGlobal(0,0),n=this._platObject.m_plate_container.globalToLocal(e.x,e.y);this.parent.removeChild(this),this._platObject.m_plate_container.addChild(this),this._platObject.m_plate_container.setChildIndex(this._mainPanel.m_plate_image,this._platObject.m_plate_container.numChildren),this.rotation-=this._platObject.m_plate_container.rotation,this.x=n.x,this.y=n.y,this.CalculateDegreeOnPlat()}this.isMe&&(GameNet.reqShoot(Math.floor(this.degree_on_plate)),0==this._platObject.random_ball_index?SoundManager.getInstance().playSound("hit_plat_1_mp3"):1==this._platObject.random_ball_index?SoundManager.getInstance().playSound("hit_plat_2_mp3"):SoundManager.getInstance().playSound("hit_plat_3_mp3"))},e.prototype.CalculateDegreeOnPlat=function(){var t=this.localToGlobal(0,0),e=this._platObject.m_plate_container.globalToLocal(t.x,t.y),n=new egret.Point;n.x=this._platObject.m_plate_container.width/2,n.y=this._platObject.m_plate_container.height/2;var i=new egret.Point;i.x=this._platObject.m_plate_container.width,i.y=this._platObject.m_plate_container.height/2;var o=new egret.Point(i.x-n.x,i.y-n.y),r=new egret.Point(e.x-n.x,e.y-n.y),a=(r.x*o.x+r.y*o.y)/(o.length*r.length),s=Math.acos(a)/Math.PI*180;e.y<n.y&&(s=360-s),this.degree_on_plate=s},e.prototype._onHitOtherKnife=function(){this.is_end=!0,egret.Tween.get(this,{loop:!0}).to({rotation:180},300).to({rotation:360},300);var t=this.x+100,e=this.y+1e3;this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2;var n=this;egret.Tween.get(this).to({x:t,y:e},1e3,egret.Ease.sineIn).call(function(){egret.Tween.removeTweens(n),n._mainPanel.ShowResult(!1)}),SoundManager.getInstance().playSound("hit_knife_mp3")},e.prototype._onHitOtherProp=function(t){if(t){var e=this;if(this.isMe){if(2==t.type){var n=Math.floor(Math.random()*KnifeConst.ALL_PROPS_ARRAY.length),i=KnifeConst.ALL_PROPS_ARRAY[n];if(i==KnifeConst.PROP_OTHER_KNIFE){var o=t.localToGlobal(t.width/2,t.height/2),r=this._mainPanel.m_plate_container.parent.globalToLocal(o.x,o.y);this._mainPanel.ShowMyKnifePropEffect(r.x,r.y)}else i==KnifeConst.PROP_DOWN_SPEED?(this._mainPanel.m_plate_object.rotate_scale=.5,this._mainPanel.PlayPlatSpeedDownAnimation(),KnifeUtils.performDelay(function(){e._mainPanel.m_plate_object.rotate_scale=1,e._mainPanel.StopPlatSpeedDownAnimation()
},3e3,this)):i==KnifeConst.PROP_WIND&&this._mainPanel.ShowWindPropEffect();GameNet.reqUseProp(i)}SoundManager.getInstance().playSound("hit_prop_mp3")}this._platObject.OnHitPropObject(this,t)}},e.prototype.Destory=function(){this.parent.removeChild(this)},e}(BaseGameObject);__reflect(KnifeObject.prototype,"KnifeObject");var KnifeUtils=function(){function t(){}return t.createDragonBones=function(t,e,n,i){var o=RES.getRes(t),r=RES.getRes(e),a=RES.getRes(n),s=dragonBones.EgretFactory.factory;s.parseDragonBonesData(o),s.parseTextureAtlasData(r,a);var _=s.buildArmatureDisplay(i);return _},t.SetColor=function(t,e){var n=function(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e},i=n(e),o=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];o[0]=i.r/255,o[6]=i.g/255,o[12]=i.b/255;var r=new egret.ColorMatrixFilter(o);t.filters=[r]},t.GetRandomPositive=function(){return 0==Math.floor(2*Math.random())?1:-1},t.GetRandomScope=function(t,e){return Math.random()*(e-t)+t},t.performDelay2=function(t,e,n){var i=new egret.Timer(e,1);return i.addEventListener(egret.TimerEvent.TIMER,function(){t&&t.apply(n)}.bind(this),this),i.start(),i},t.performDelay=function(t,e,n){setTimeout(function(){t&&t.apply(n)},e)},t}();__reflect(KnifeUtils.prototype,"KnifeUtils");var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e._all_knife_imgs=[],e.all_round_configs=[],e._waiting_join=!0,e.serverModel=new ServerModel,e._is_game_over=!1,e._all_broken_armatureDisplays=[],e._is_last_round_win=!1,e.is_connecting=!1,e.skinName="MainSceneSkin";for(var n=RES.getRes("rounds_json"),i=0;i<n.length;i++){var o=n[i],r=new RoundConfig(o);e.all_round_configs.push(r)}for(var i=n.length-1;i>=0;i--)e.all_round_configs.push(e.all_round_configs[n.length-i-1]);return e}return __extends(e,t),e.prototype.resizeStage=function(){t.prototype.resizeStage.call(this),this.m_top_ui.y=85},e.prototype.createChildren=function(){t.prototype.createChildren.call(this);for(var e=1;10>=e;e++){var n=this["img_knife_"+e];this._all_knife_imgs.push(n),n.visible=!1}this.m_plate_container.visible=!1,this.m_top_ui.visible=!1,this.m_offline_tips.visible=!1;var i=this,o=this.img_help.scaleX,r=this.img_help.scaleY;this.btn_help.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){i.img_help.visible=!0,i.img_help.scaleX=i.img_help.scaleY=0,egret.Tween.get(i.img_help).to({scaleX:o,scaleY:r},200),t.stopPropagation()}.bind(this),this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_END,function(t){egret.Tween.get(i.img_help).to({scaleX:0,scaleY:0},100).call(function(){i.img_help.visible=!1})}.bind(this),this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(t){egret.Tween.get(i.img_help).to({scaleX:0,scaleY:0},100).call(function(){i.img_help.visible=!1})}.bind(this),this),this._addAnimation(),this._addCircleMask(this.img_other_icon,this.img_other_icon_bg.x+this.img_other_icon_bg.width/2,this.img_other_icon_bg.y+this.img_other_icon_bg.height/2,this.img_other_icon_bg.width/2-5),this._addCircleMask(this.img_me_icon,this.img_me_icon_bg.x+this.img_me_icon_bg.width/2,this.img_me_icon_bg.y+this.img_me_icon_bg.height/2,this.img_me_icon_bg.width/2-5)},e.prototype._addCircleMask=function(t,e,n,i){var o=new egret.Shape;o.graphics.beginFill(255),o.graphics.drawCircle(e,n,i),o.graphics.endFill(),t.parent.addChild(o),t.mask=o},e.prototype._addAnimation=function(){var t=KnifeUtils.createDragonBones("wind_ske_json","wind_tex_json","wind_tex_png","wind_armature");this.m_plate_container.parent.addChild(t),t.scaleX=t.scaleY=1.5,t.x=this.m_place_feng.x,t.y=this.m_place_feng.y,t.visible=!1,this._wind_armatureDisplay=t;var e=KnifeUtils.createDragonBones("knife_shadow_ske_json","knife_shadow_tex_json","knife_shadow_tex_png","knife_shadow_armature");this.m_plate_container.parent.addChild(e),e.x=this.m_place_feng.x,e.y=this.m_place_feng.y+100,e.visible=!1,this._knife_shadow_armatureDisplay=e,e.addDBEventListener(dragonBones.AnimationEvent.COMPLETE,function(){},this);var n=KnifeUtils.createDragonBones("explosion_ske_json","explosion_tex_json","explosion_tex_png","explosion_armature");this.m_plate_container.parent.addChild(n),n.visible=!1,this._explosion_armatureDisplay=n;var i=KnifeUtils.createDragonBones("ready_go_ske_json","ready_go_tex_json","ready_go_tex_png","ready_go_armature");this.addChild(i),i.visible=!1,this._ready_go_armatureDisplay=i,i.x=this.stage.stageWidth/2,i.y=this.stage.stageHeight/2;var o=KnifeUtils.createDragonBones("normal_change_ske_json","normal_change_tex_json","normal_change_tex_png","normal_change_armature");this.addChild(o),o.visible=!1,this._normal_change_armatureDisplay=o,o.x=this.width/2,o.y=this.height/2;var r=KnifeUtils.createDragonBones("boss_change_ske_json","boss_change_tex_json","boss_change_tex_png","boss_change_armature");this.addChild(r),r.visible=!1,this._boss_change_armatureDisplay=r,r.x=this.width/2,r.y=this.height/2,this._normal_change_armatureDisplay.addDBEventListener(dragonBones.AnimationEvent.COMPLETE,this._playRoundChange,this),this._boss_change_armatureDisplay.addDBEventListener(dragonBones.AnimationEvent.COMPLETE,this._playRoundChange,this);for(var a=0;a<KnifeConst.MAX_BALL_COUNT;a++){var s="broken"+(a+1).toString(),_=KnifeUtils.createDragonBones(s+"_ske_json",s+"_tex_json",s+"_tex_png",s+"_armature");_.visible=!1,this._all_broken_armatureDisplays.push(_),_.scaleX=_.scaleY=1,this.m_broken_plate_container.addChild(_),_.x=this.m_broken_plate_container.width/2,_.y=this.m_broken_plate_container.height/2,_.addDBEventListener(dragonBones.Event.COMPLETE,function(){t.visible=!1},this)}var l=KnifeUtils.createDragonBones("speed_down_ske_json","speed_down_tex_json","speed_down_tex_png","speed_down_armature");this.m_plate_container.parent.addChild(l),l.x=this.m_plate_container.x,l.y=this.m_plate_container.y+50,l.visible=!1,this._speed_down_armatureDisplay=l,l.animation.play("speed_down_animation",-1);var h=RES.getRes("light1_png"),c=RES.getRes("light1_json"),p=new particle.GravityParticleSystem(h,c);this.addChild(p),this._light_particle=p;var u=RES.getRes("light3_png"),d=RES.getRes("light3_json"),f=new particle.GravityParticleSystem(u,d);this.addChild(f),this._xigua_particle=f},e.prototype.PlayReadyAnimation=function(){var t=this;this._ready_go_armatureDisplay.addDBEventListener(dragonBones.AnimationEvent.COMPLETE,function(){t.StartGame(),t._ready_go_armatureDisplay.visible=!1},this),this._ready_go_armatureDisplay.animation.play("ready_go_animation",1),this._ready_go_armatureDisplay.visible=!0,SoundManager.getInstance().playSound("ready_go_mp3")},e.prototype.PlayKnifeHitAnimation=function(t){var e=this._light_particle;3==this.m_plate_object.random_ball_index&&(e=this._xigua_particle);var n=t.hit_ball_rect.localToGlobal(t.hit_ball_rect.width/2,t.hit_ball_rect.height/2),i=e.parent.globalToLocal(n.x,n.y);e.start(100),e.x=i.x,e.y=i.y},e.prototype.PlayChangeRoundAnimation=function(t){var e=this._normal_change_armatureDisplay;this.serverModel.myRole.level%3==0&&(e=this._boss_change_armatureDisplay),e.x=this.width/2,e.y=this.height/2;e.visible=!0,e==this._normal_change_armatureDisplay?(e.animation.play("normal_change_animation",1),this.m_round_change.visible=!0):(e.animation.play("boss_change_animation",1),SoundManager.getInstance().playSound("boss_round_mp3")),this.label_tips_round.text=this.serverModel.myRole.level.toString(),this._playRoundCallback=t},e.prototype._playRoundChange=function(){this._normal_change_armatureDisplay.visible=!1,this._boss_change_armatureDisplay.visible=!1,this.m_round_change.visible=!1,this._playRoundCallback&&(this._playRoundCallback(),this._playRoundCallback=null)},e.prototype.PlayPlatBrokenAnimation=function(){var t=this.m_plate_object.random_ball_index;0==t?SoundManager.getInstance().playSound("broken1_mp3"):1==t?SoundManager.getInstance().playSound("broken2_mp3"):SoundManager.getInstance().playSound("broken3_mp3");var e=this._all_broken_armatureDisplays[t],n="broken"+(t+1)+"_animation";e.animation.play(n,1),e.visible=!0;var i=function(){e.visible=!1,e.removeDBEventListener(dragonBones.Event.COMPLETE,i,this)};e.addDBEventListener(dragonBones.Event.COMPLETE,i,this)},e.prototype.PlayPlatSpeedDownAnimation=function(){this._speed_down_armatureDisplay.visible=!0,SoundManager.getInstance().playSound("speed_down_mp3"),this._showMyPropEffect(this.prop_my_effect_1)},e.prototype.StopPlatSpeedDownAnimation=function(){this._speed_down_armatureDisplay.visible=!1},e.prototype.StartGame=function(){this.m_plate_container.visible=!0,this.m_top_ui.visible=!0,this.btn_help.visible=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.m_plate_object=new PlateObject(this),this.m_touch_layer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this._update_player_info(),this._update_player_round(),this.validateNow(),this.NextRound(),this._startTimer()},e.prototype.ReStartGame=function(){this.m_knife_object&&(this.m_knife_object.Destory(),this.m_knife_object=null),this._other_knife_object&&(this._other_knife_object.Destory(),this._other_knife_object=null),this.NextRound()},e.prototype.NextRound=function(){var t=this.all_round_configs[this.serverModel.myRole.level-1];t.Reset(),this.m_plate_object.EnterNextBigRound(t),this.GenerateNextKnife();for(var e=0;e<this._all_knife_imgs.length;e++){var n=this._all_knife_imgs[e];n.source="knifeicon11_png",n.visible=!1}for(var e=0;e<this.m_plate_object.GetMaxKnifeCount();e++){var n=this._all_knife_imgs[e];n.visible=!0}},e.prototype.OnMyKnifeHitBall=function(){var t=this.m_plate_object.GetAllMyKnifeCount(),e=this._all_knife_imgs[t-1];e.source="knifeicon12_png"},e.prototype._onEnterFrame=function(t){if(this.m_knife_object){var e=this,n=this.m_knife_object.UpdateVersion2(function(t){e.m_plate_object.UpdateVersion2(t)});e.m_plate_object.UpdateVersion2(n)}else this.m_plate_object.UpdateVersion2(1);this.m_plate_object.has_other_knife&&this.m_plate_object.IsReady()&&this.m_plate_object.CheckCanInsertOtherKnife()&&(this.m_plate_object.has_other_knife=!1,this.GenerateOtherKnife()),this._other_knife_object&&(this._other_knife_object.Update(),this._other_knife_object.is_end&&(this._other_knife_object=null))},e.prototype._onTouchBegin=function(t){if(this.m_plate_object.IsReady()&&this.m_knife_object){if(this.m_knife_object.is_end)return;this.m_knife_object.StartTouchMove()}},e.prototype.GenerateNextKnife=function(){this.m_knife_object=new KnifeObject(this),this.m_container_layer.addChild(this.m_knife_object),this.m_knife_object.StartBirthMove(this.m_example_knife.x,this.m_example_knife.y)},e.prototype.GenerateOtherKnife=function(){if(!this._other_knife_object){var t=this.m_plate_container.parent.localToGlobal(this.m_plate_container.x+this.m_plate_container.width/2+100,this.m_plate_container.y-this.m_plate_container.height/2-100),e=this.m_container_layer.globalToLocal(t.x,t.y),n=new KnifeObject(this);n.isMe=!1,n.x=e.x,n.y=e.y,n.rotation=225,n.speedY=100,n.speedX=-100,n.acceY=0,this.m_container_layer.addChild(n),this._other_knife_object=n}},e.prototype.ShowResult=function(t){this._speed_down_armatureDisplay.visible=!1,this._is_last_round_win=t;var e=this;t?this.m_plate_object.ShowWinAnimation(function(){e._onPlayFlyUpCompelete()}):KnifeUtils.performDelay(function(){e._onPlayFlyUpCompelete()},100,this)},e.prototype._onPlayFlyUpCompelete=function(){if(this._is_last_round_win){this.serverModel.myRole.level+=1,this._update_player_round(),GameNet.reqSwitch(this.serverModel.myRole.level);var t=this;this.PlayChangeRoundAnimation(function(){t.NextRound()})}else this.NextRound()},e.prototype._startTimer=function(){var t=new egret.Timer(1e3,Const.GAME_TIME);t.addEventListener(egret.TimerEvent.TIMER,this._on_timer_tick,this),t.start(),this._timer=t,this._update_left_time()},e.prototype._on_timer_tick=function(){this.serverModel.left_time-=1,this.serverModel.left_time<=0&&!this._is_game_over&&!GameNet.isConnected()&&this._on_game_over(),this.serverModel.left_time<=0&&this._clearGame(),this._update_left_time()},e.prototype._clearTimer=function(){this._timer&&(this._timer.stop(),this._timer=null)},e.prototype._clearGame=function(){this.m_plate_container.visible=!1,this._clearTimer(),this.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},e.prototype._on_game_over=function(){if(!this._is_game_over){this._is_game_over=!0,this._clearGame();var t=2;KnifeUtils.performDelay(function(){GamePlatform.onFinished()}.bind(this),1e3*t,this)}},e.prototype._update_left_time=function(){this.label_left_time.text=this.serverModel.left_time.toString()},e.prototype._update_player_info=function(){this.label_other_name.text=this.serverModel.otherRole.nickname,this.label_me_name.text=this.serverModel.myRole.nickname,egret.ImageLoader.crossOrigin="anonymous",this.serverModel.myRole.icon&&(this.img_me_icon.source=this.serverModel.myRole.icon),this.serverModel.otherRole.icon&&(this.img_other_icon.source=this.serverModel.otherRole.icon)},e.prototype._update_player_round=function(){this.label_me_round.text=this.serverModel.myRole.level.toString(),this.label_other_round.text=this.serverModel.otherRole.level.toString()},e.prototype.onLevelPush=function(t,e){this.serverModel.UpdateRoleLevel(e),this._update_player_round()},e.prototype.onRefreshPush=function(){},e.prototype.onUsePropPush=function(t,e){var n=e.prop;this.ShowOtherPropEffect(n)},e.prototype.ShowOtherPropEffect=function(t){var e=this;t==KnifeConst.PROP_WIND?(this._wind_armatureDisplay.visible=!0,this._wind_armatureDisplay.animation.stop(),this._wind_armatureDisplay.animation.play("xuanzhuan",-1),KnifeUtils.performDelay(function(){e._wind_armatureDisplay.visible=!1,e._wind_armatureDisplay.animation.stop()}.bind(this),3e3,this),this._showOtherPropEffect(this.prop_effect_other_1),SoundManager.getInstance().playSound("wind_mp3")):t==KnifeConst.PROP_OTHER_KNIFE&&(this.m_plate_object.WaitToInsertNewKnife(),this._showOtherPropEffect(this.prop_effect_other_2))},e.prototype.ShowMyKnifePropEffect=function(t,e){this._knife_shadow_armatureDisplay.visible=!0,this._knife_shadow_armatureDisplay.animation.stop(),this._knife_shadow_armatureDisplay.animation.play("knife_shadow_animation",1),this._explosion_armatureDisplay.visible=!0,this._explosion_armatureDisplay.animation.stop(),this._explosion_armatureDisplay.animation.play("explosion_animation",1),this._explosion_armatureDisplay.x=t,this._explosion_armatureDisplay.y=e,SoundManager.getInstance().playSound("other_knife_mp3"),this._showMyPropEffect(this.prop_my_effect_2)},e.prototype.ShowWindPropEffect=function(){this._showMyPropEffect(this.prop_my_effect_3)},e.prototype._showMyPropEffect=function(t){t.visible=!0,t.x=this.width+t.width;var e=this.width;egret.Tween.get(t).to({x:e},200).call(function(){KnifeUtils.performDelay(function(){t.visible=!1},2e3,this)})},e.prototype._showOtherPropEffect=function(t){t.visible=!0,t.x=0-t.width;var e=0;egret.Tween.get(t).to({x:e},200).call(function(){KnifeUtils.performDelay(function(){t.visible=!1},2e3,this)})},e.prototype.onDisconnected=function(){if(this.m_offline_tips.visible=!0,!this._is_game_over){if(GameNet.onDisconnected=this.onDisconnected.bind(this),this.is_connecting){var t=this;return void KnifeUtils.performDelay(function(){this._is_game_over||GameNet.isConnected()||(t.is_connecting=!0,t.reconnect())}.bind(this),3e3,this)}this.is_connecting=!0,this.reconnect()}},e.prototype.reconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,GameNet.connectServer()];case 1:return t.sent(),[4,GameNet.reqLogin(User.roomId)];case 2:return t.sent(),[4,GameNet.reqReEnter(this.serverModel.myRole.level)];case 3:return t.sent(),this.is_connecting=!1,this.m_offline_tips.visible=!1,[2]}})})},e.prototype.onJoinPush=function(){},e.prototype.onGameStatusPush=function(){},e.prototype._real_join=function(t){if(GamePlatform.onStarted(function(){}.bind(this)),t.player_list){var e=t.player_list;if(e&&e.length>0)for(var n=0;n<e.length;n++)this.serverModel.AddRole(e[n]);this.PlayReadyAnimation()}GamePlatform.registerSurrenderCallback(function(){GameNet.reqSurrend()})},e.prototype.onGameStartPush=function(t,e){if(!this._waiting_join)return void this._real_join(e);var n=this;KnifeUtils.performDelay(function(){n._real_join(e)}.bind(this),1e3,this)},e.prototype.onGameSecondPush=function(t,e){var n=e.second;Math.abs(n-this.serverModel.left_time)>2&&(this.serverModel.left_time=n)},e.prototype.onGameScorePush=function(t,e){},e.prototype.onGameOverPush=function(t,e){var n=e.result;if(void 0!=n){var i=n.winners;if(void 0!=i){var o=i;1!=o.length?SoundManager.getInstance().playSound("game_result_draw_mp3"):o[0]==this.serverModel.myRole.openid?SoundManager.getInstance().playSound("game_result_win_mp3"):SoundManager.getInstance().playSound("game_result_fail_mp3")}}this._on_game_over()},e.prototype.onGameReEnterPush=function(){},e.prototype.onOpen=function(){t.prototype.onOpen.call(this);var e=io.GameNet.GAME_PROTOCOL;GameNet.on(e.CMD_H5_KNIFE_LEVEL_PUSH,this.onLevelPush.bind(this)),GameNet.on(e.CMD_H5_KNIFE_REFRESH_PUSH,this.onRefreshPush.bind(this)),GameNet.on(e.CMD_H5_KNIFE_USEPROP_PUSH,this.onUsePropPush.bind(this)),GameNet.on(e.CMD_H5_JOIN_PUSH,this.onJoinPush.bind(this)),GameNet.on(e.CMD_H5_GAME_STATUS_PUSH,this.onGameStatusPush.bind(this)),GameNet.on(e.CMD_H5_GAME_START_PUSH,this.onGameStartPush.bind(this)),GameNet.on(e.CMD_H5_SECOND_PUSH,this.onGameSecondPush.bind(this)),GameNet.on(e.CMD_H5_SCORE_PUSH,this.onGameScorePush.bind(this)),GameNet.on(e.CMD_H5_GAME_OVER_PUSH,this.onGameOverPush.bind(this)),GameNet.on(e.CMD_H5_REENTER_PUSH,this.onGameReEnterPush.bind(this)),GameNet.onDisconnected=this.onDisconnected.bind(this),GamePlatform.onInit(),this.run(),this._waiting_join=!0;var n=this;KnifeUtils.performDelay(function(){n._waiting_join=!1}.bind(this),1e3,this),GamePlatform.onWaiting(function(){}.bind(this))},e.prototype.run=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,GameNet.connectServer()];case 1:return t.sent(),[4,GameNet.reqLogin(User.roomId)];case 2:return t.sent(),[4,GameNet.reqJoin()];case 3:return t.sent(),[2]}})})},e.prototype._createDebug=function(){var t={};t.Id=User.openId,t.level=1,t.nickname="User1",t.icon="",this.serverModel.AddRole(t);var e={};t.Id=User.openId+1,t.level=2,t.nickname="User2",t.icon="",this.serverModel.AddRole(e),this.PlayReadyAnimation()},e}(t.Window);t.MainGameScene=e,__reflect(e.prototype,"ui.MainGameScene")}(ui||(ui={}));var PlateObject=function(){function t(t){this.all_sort_game_objects=[],this.all_knife_objects=[],this.all_prop_objects=[],this.rotate_scale=1,this.random_ball_index=0,this.has_other_knife=!1,this._mainPanel=t,this.m_plate_container=t.m_plate_container,this.m_plate_container.scaleX=this.m_plate_container.scaleY=0,this.m_plate_image=t.m_plate_image}return t.prototype.RandomChangeBallBg=function(){var t=this.roundPlateRotateStrategy.roundConfig.skin-1,e="ball"+(t+1)+"_png";this.m_plate_image.source=e,this.random_ball_index=t},t.prototype.IsReady=function(){return this._isReady},t.prototype.GetGlobalCenterPoint=function(){var t=this.m_plate_container.localToGlobal(this.m_plate_container.width/2,this.m_plate_container.height/2);return t},t.prototype.EnterNextBigRound=function(t){this.rotate_scale=1,this.roundPlateRotateStrategy=new RoundPlateRotateStrategy(t),this.RandomChangeBallBg(),this._isReady=!1;var e=this;this.m_plate_container.visible=!0,this.m_plate_container.rotation=0,this.m_plate_container.scaleX=this.m_plate_container.scaleY=0,egret.Tween.get(this.m_plate_container).to({scaleX:1.2,scaleY:1.2},250).call(function(){egret.Tween.get(e.m_plate_container).to({scaleX:1,scaleY:1},100),e._isReady=!0});for(var n in this.all_knife_objects){var i=this.all_knife_objects[n];i.parent.removeChild(i)}for(var n in this.all_prop_objects){var o=this.all_prop_objects[n];o.parent.removeChild(o)}this.all_knife_objects=[],this.all_sort_game_objects=[],this.all_prop_objects=[],this._createInitMaterials()},t.prototype._createInitMaterials=function(){for(var t=this.roundPlateRotateStrategy.roundConfig.materialConfigs,e=0;e<t.length;e++)for(var n=t[e],i=n.type,o=0;o<n.count;o++)if(1==i){var r=new KnifeObject(this._mainPanel,!0);this.m_plate_container.addChild(r),r.isMe=!1,r.anchorOffsetX=r.hit_ball_rect.x+r.hit_ball_rect.width/2,r.anchorOffsetY=r.hit_ball_rect.y+r.hit_ball_rect.height/2;var a=n.getRandomDegree(o);r.x=this.m_plate_container.width/2+this.m_plate_container.width/2*Math.cos(a/180*Math.PI),r.y=this.m_plate_container.height/2+this.m_plate_container.height/2*Math.sin(a/180*Math.PI),r.rotation=a-90,this._pushNewKnifeObject(r)}else if(2==i){var s=new PropObject;s.type=i,this.m_plate_container.addChild(s);var a=n.getRandomDegree(o);s.width;s.anchorOffsetX=s.width/2,s.x=this.m_plate_container.width/2+this.m_plate_container.width/2*Math.cos(a/180*Math.PI),s.y=this.m_plate_container.height/2+this.m_plate_container.height/2*Math.sin(a/180*Math.PI),s.rotation=a-90,s.degree_on_plate=a,0>a&&(a+=360),this._pushNewPropObject(s)}this.m_plate_container.setChildIndex(this._mainPanel.m_plate_image,this.m_plate_container.numChildren)},t.prototype.GetMaxKnifeCount=function(){return this.roundPlateRotateStrategy.maxKnifeCount},t.prototype.Update=function(){if(this._isReady){var t=this.roundPlateRotateStrategy.Step(1/30)*this.rotate_scale;this.m_plate_container.rotation+=t}},t.prototype.UpdateVersion2=function(t){if(void 0===t&&(t=1),this._isReady){var e=this.roundPlateRotateStrategy.Step(1/30*t)*this.rotate_scale*t;this.m_plate_container.rotation+=e}},t.prototype.WaitToInsertNewKnife=function(){this.has_other_knife||(this.has_other_knife=!0)},t.prototype.GetAllMyKnifeCount=function(){for(var t=0,e=0;e<this.all_knife_objects.length;e++){var n=this.all_knife_objects[e];n.isMe&&(t+=1)}return t},t.prototype._pushNewKnifeObject=function(t){this.all_knife_objects.push(t),this.all_sort_game_objects.push(t),this.all_sort_game_objects.sort(function(t,e){return t.degree_on_plate<e.degree_on_plate}.bind(this))},t.prototype._pushNewPropObject=function(t){this.all_prop_objects.push(t),this.all_sort_game_objects.push(t),this.all_sort_game_objects.sort(function(t,e){return t.degree_on_plate<e.degree_on_plate}.bind(this))},t.prototype.OnHitOtherKnife=function(t){var e=this;this._pushNewKnifeObject(t),t.isMe&&this._mainPanel.OnMyKnifeHitBall();var n=this.GetAllMyKnifeCount()>=this.roundPlateRotateStrategy.maxKnifeCount;if(t.isMe){var i=this.m_plate_container.x,o=this.m_plate_container.y,r=o-KnifeConst.Shake_Range;egret.Tween.get(this.m_plate_container).to({x:i,y:r},50).to({x:i,y:o},50).call(function(){n&&(e.m_plate_container.visible=!1,e._mainPanel.PlayPlatBrokenAnimation(),e._mainPanel.ShowResult(!0))})}else{var i=this.m_plate_container.x,o=this.m_plate_container.y,a=i-KnifeConst.Shake_Range,s=o+KnifeConst.Shake_Range;egret.Tween.get(this.m_plate_container).to({x:a,y:s},50).to({x:i,y:o},50).call(function(){})}return t.label_index=this.all_knife_objects.length,t.testLabel.text=this.all_knife_objects.length.toString(),!n&&t.isMe&&this._mainPanel.GenerateNextKnife(),n&&(this._isReady=!1),n},t.prototype.OnHitPropObject=function(t,e){var n=this.all_prop_objects.indexOf(e);n>=0&&this.all_prop_objects.splice(n,1);var i=this.all_sort_game_objects.indexOf(e);i>=0&&this.all_sort_game_objects.splice(i,1),e.PlayBrokenAnimation()},t.prototype.CheckCanInsertOtherKnife=function(){var t=30,e=20,n=this.roundPlateRotateStrategy.GetCurrentStrategy().direction,i=(315-(this.m_plate_container.rotation+360)%360+360)%360,o=t,r=e;n==RotateDirection.NEGATIVE&&(o=e,r=t);for(var a=0;a<this.all_sort_game_objects.length;a++){var s=this.all_sort_game_objects[a];if(i>=s.degree_on_plate-o&&i<=s.degree_on_plate+r)return!1}return!0},t.prototype.ShowWinAnimation=function(t){this._mainPanel.m_copy_plat_container.rotation=this.m_plate_container.rotation;for(var e=function(e){var i=n.all_sort_game_objects[e];i==n.all_knife_objects[n.all_knife_objects.length-1]||(i.parent.removeChild(i),n._mainPanel.m_copy_plat_container.addChild(i));var o=i.localToGlobal(i.width/2,i.height/2),r=i.parent.globalToLocal(o.x,o.y);i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=r.x,i.y=r.y;if(i==n.all_knife_objects[n.all_knife_objects.length-1]){var a=new egret.Point(o.x,300),s=i.parent.globalToLocal(a.x,a.y),_=new egret.Point(o.x,n._mainPanel.height),l=i.parent.globalToLocal(_.x,_.y),h=1e3;egret.Tween.get(i).to({x:s.x,y:s.y+200},.1*h).call(function(){egret.Tween.get(i).to({rotation:180},.5*h)}).to({x:s.x,y:s.y},.5*h,egret.Ease.sineOut).call(function(){egret.Tween.get(i).to({rotation:360},.5*h).call(function(){i.rotation=0,egret.Tween.get(i,{loop:!0}).to({rotation:180},.5*h).to({rotation:360},.5*h)})}).to({x:l.x,y:l.y},1*h,egret.Ease.sineIn).call(function(){egret.Tween.removeTweens(i),i.visible=!1,t&&(t(),t=null)})}else{var c=i.localToGlobal(i.width/2,0),p=new egret.Point(o.x-c.x,o.y-c.y);p.normalize(1);var u=new egret.Point(o.x+100*p.x,o.y+100*p.y),a=new egret.Point(u.x,u.y),s=i.parent.globalToLocal(a.x,a.y),_=new egret.Point(u.x,u.y+1200),l=i.parent.globalToLocal(_.x,_.y),d=1e3;egret.Tween.get(i).to({x:s.x,y:s.y},40,egret.Ease.sineOut).to({x:l.x,y:l.y},d,egret.Ease.sineIn).call(function(){i.visible=!1,egret.Tween.removeTweens(i)}),egret.Tween.get(i).to({rotation:i.rotation+180},d)}},n=this,i=0;i<this.all_sort_game_objects.length;i++)e(i)},t}();__reflect(PlateObject.prototype,"PlateObject");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.setStageSize(!1),WindowManager=ui.WindowManager.getInstance(),GameNet=io.GameNet.getInstance(),""==User.openId&&(User.openId=GamePlatform.GetMyOpenId()),""==User.roomId&&(User.roomId=GamePlatform.GetRoomId()),User.openId&&0!=User.openId.length||(User.openId=(new Date).getTime().toString()+Math.floor(1e4*Math.random()).toString(),egret.localStorage.setItem("openId",User.openId),User.roomId="0");var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.setStageSize=function(t){var e=egret.Capabilities.boundingClientWidth,n=egret.Capabilities.boundingClientHeight,i=Const.MIN_WIDTH,o=Const.MIN_HEIGHT,r=i/o,a=0,s=0;r>=e/n?(a=i,s=Math.floor(n/e*a)):1.2*r>=e/n?(a=i,s=Math.floor(n/e*a)):(a=i,s=o),this.stage.removeEventListener(egret.Event.RESIZE,this.onStageResize,this),this.stage.setContentSize(a,s),this.stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this),t&&EventEmitter.getInstance().dispatchEventWith(Const.EVENT.ON_STAGE_RESIZE,!1,{width:this.stage.stageWidth,height:this.stage.stageHeight})},e.prototype.onStageResize=function(){this.setStageSize(!0)},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),ui.WindowManager.getInstance().open("MainGameScene"),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[4,RES.loadGroup("preload")];case 3:return e.sent(),[3,5];case 4:return t=e.sent(),console.error(t),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.uiLayer=new egret.DisplayObjectContainer,this.coverLayer=new egret.DisplayObjectContainer,this.topLayer=new egret.DisplayObjectContainer,this.addChild(this.uiLayer),this.addChild(this.coverLayer),this.addChild(this.topLayer),ui.WindowManager.getInstance().initialize(this)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var RoleInfo=function(){function t(){this.icon="",this.nickname="",this.openid="",this.level=1,this.score=0}return t}();__reflect(RoleInfo.prototype,"RoleInfo");var ServerModel=function(){function t(){this.my_icon_url="",this.other_icon_url="",this.left_time=Const.GAME_TIME}return t.prototype.AddRole=function(t){var e=new RoleInfo;t.openid&&(e.openid=t.openid),t.Id&&(e.openid=t.Id),t.nickname&&(e.nickname=t.nickname),t.icon&&(e.icon=t.icon),e.level=1,e.score=1,e.openid==User.openId.toString()?this.myRole=e:this.otherRole=e,console.log(t)},t.prototype.UpdateRoleScore=function(t){var e=t.openid;this.myRole.openid==e||this.otherRole.openid==e&&(this.otherRole.score=t.total)},t.prototype.UpdateRoleLevel=function(t){var e=t.id;this.myRole.openid==e||this.otherRole.openid==e&&(this.otherRole.level=t.level)},t.prototype.ReEnterUpdateRoleInfo=function(t,e){if("undefined"!=typeof t&&"undefined"!=typeof e&&2==e.length&&2==t.length){var n=t[0],i=n.openid==User.openId;i?(this.myRole.score=e[0],this.otherRole.score=e[1]):(this.myRole.score=e[1],this.otherRole.score=e[0])}},t}();__reflect(ServerModel.prototype,"ServerModel");var ui;!function(t){var e=function(e){function i(){var n=e.call(this)||this;return n.dataArray=new eui.ArrayCollection,n._mainPanel=t.WindowManager.getInstance().getWindow("MainGameScene"),n.skinName="SettingSkin",n}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.m_scroller.viewport=this.m_list,this.m_list.dataProvider=this.dataArray,this.m_list.itemRenderer=n;var i=this.m_list.layout;i.gap=10;var o=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.WindowManager.getInstance().close("SettingPanel"),e.stopPropagation()}.bind(this),this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var e={direction:1,duration:0,speed:0},n=new StrategyConfig(e),i=o.m_list.dataProvider;i.addItem(n),t.stopPropagation()}.bind(this),this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){o._reloadData(),o._mainPanel.ReStartGame(),t.WindowManager.getInstance().close("SettingPanel"),e.stopPropagation()}.bind(this),this),this._loadData()},i.prototype._reloadData=function(){for(var t=[],e=0;e<this.m_list.dataProvider.length;e++){var n=this.m_list.getElementAt(e);n&&n.ReloadData(),t.push(n.data)}var i=this._mainPanel.all_round_configs[this._mainPanel.serverModel.myRole.level-1];i.strategys=t},i.prototype._loadData=function(){for(var t=this._mainPanel.m_plate_object.roundPlateRotateStrategy.roundConfig.strategys,e=0;e<t.length;e++)this.dataArray.addItem(t[e])},i}(t.Window);t.SettingPanel=e,__reflect(e.prototype,"ui.SettingPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="SettingItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=this;this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var n=e.parent;if(n){var i=n.dataProvider;i.removeItemAt(e.itemIndex)}t.stopPropagation()}.bind(this),this)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this._updateView()},enumerable:!0,configurable:!0}),e.prototype._updateView=function(){this._data&&(this.edit_speed.text=this._data.speed.toString(),this.edit_duration.text=this._data.duration.toString(),this.edit_fadetime.text=this._data.fadeTime.toString())},e.prototype.ReloadData=function(){var t=parseFloat(this.edit_fadetime.text);null!=t&&(this._data.fadeTime=t);var e=parseFloat(this.edit_duration.text);null!=e&&(this._data.duration=e);
var n=parseFloat(this.edit_speed.text);null!=n&&(this._data.speed=n)},e}(eui.Component);__reflect(n.prototype,"SettingItem",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"])}(ui||(ui={}));